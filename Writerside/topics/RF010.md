# RF010 â° Registro e acompanhamento do status de pagamento de transaÃ§Ãµes

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade permite o registro e acompanhamento do status de pagamento de transaÃ§Ãµes (receitas e despesas)
avulsas, recorrentes e parceladas, incluindo datas de vencimento e datas de pagamento, oferecendo uma visÃ£o clara do
fluxo de caixa e obrigaÃ§Ãµes financeiras.

## ðŸ‘¥ Atores

- ðŸ‘¤ UsuÃ¡rio Autenticado
- âš™ï¸ Sistema (para atualizaÃ§Ãµes automÃ¡ticas de status e alertas)

## âš ï¸ PrÃ©-condiÃ§Ãµes

- O usuÃ¡rio deve estar logado no sistema.
- Deve haver transaÃ§Ãµes (avulsas, recorrentes ou parceladas) registradas no sistema.

## ðŸ”Œ Endpoints

- `PUT /api/transactions/{transactionId}/status` (para transaÃ§Ãµes avulsas ou ocorrÃªncias de recorrentes/parceladas)
- `GET /api/transactions/summary-by-status` (obter resumo de status)
- `GET /api/transactions?status={status}` (filtrar transaÃ§Ãµes por status)

## ðŸ“‹ Dados de Status de Pagamento

| Campo            | Tipo     | ObrigatÃ³rio                            | DescriÃ§Ã£o                                   | RestriÃ§Ãµes                                      |
|------------------|----------|----------------------------------------|---------------------------------------------|-------------------------------------------------|
| `transaction_id` | `string` | âœ… Sim                                  | ID da transaÃ§Ã£o ou parcela a ser atualizada | UUID vÃ¡lido, transaÃ§Ã£o/parcela existente        |
| `status`         | `string` | âœ… Sim                                  | Status de pagamento                         | `paid`, `pending`, `overdue`, `due_soon`        |
| `due_date`       | `string` | âœ… Sim (para transaÃ§Ãµes com vencimento) | Data de vencimento da transaÃ§Ã£o/parcela     | Formato YYYY-MM-DD                              |
| `payment_date`   | `string` | â¬œ NÃ£o                                  | Data em que a transaÃ§Ã£o foi paga            | Formato YYYY-MM-DD, nÃ£o futura, apÃ³s `due_date` |

## ðŸ”„ Fluxo Principal - Acompanhamento e AtualizaÃ§Ã£o Manual

```mermaid
sequenceDiagram
    actor U as UsuÃ¡rio
    participant S as Sistema
    participant BD as Banco de Dados
    U->>S: Acessa a lista de transaÃ§Ãµes
    S->>BD: Solicita transaÃ§Ãµes com status e datas de vencimento
    BD->>S: Retorna transaÃ§Ãµes
    S->>U: Exibe transaÃ§Ãµes com status (Pendente, Vencida, Paga)
    U->>S: Seleciona uma transaÃ§Ã£o/parcela para atualizar status
    S->>U: Exibe opÃ§Ãµes de status (ex: Marcar como Paga)
    U->>S: Confirma alteraÃ§Ã£o de status (ex: para 'Paga')
    S->>S: Valida a alteraÃ§Ã£o e atualiza o saldo da conta
    S->>BD: Atualiza status e data de pagamento (se aplicÃ¡vel)
    BD->>S: Confirma atualizaÃ§Ã£o
    S->>U: Exibe mensagem de sucesso e status atualizado
```

1. O usuÃ¡rio autenticado acessa a seÃ§Ã£o de transaÃ§Ãµes, que pode incluir receitas e despesas avulsas, recorrentes e
   parcelas.
2. O sistema exibe uma lista de transaÃ§Ãµes com seu status de pagamento atual (ex: Paga, Pendente, A Pagar, Vencida) e
   suas respectivas datas de vencimento.
3. O sistema atualiza automaticamente o status de transaÃ§Ãµes para `overdue` quando a data de vencimento Ã© ultrapassada e
   nÃ£o estÃ¡ `paid`.
4. O usuÃ¡rio pode selecionar uma transaÃ§Ã£o (ou uma parcela de uma transaÃ§Ã£o parcelada) e optar por atualizar manualmente
   seu status (ex: marcar como `paid`).
5. Ao marcar uma despesa como `paid`, o sistema valida e registra a saÃ­da do valor da conta associada e a data de
   pagamento.
6. Ao marcar uma receita como `paid`, o sistema valida e registra a entrada do valor na conta associada e a data de
   pagamento.
7. O sistema exibe uma mensagem de confirmaÃ§Ã£o de sucesso e o status da transaÃ§Ã£o Ã© atualizado na lista.

## ðŸ”€ Fluxos Alternativos

### âš ï¸ FA01 - Alertas de Vencimento

1. O sistema verifica periodicamente as transaÃ§Ãµes com `due_date` prÃ³xima ou que jÃ¡ estÃ£o vencidas e `status` diferente
   de `paid`.
2. O sistema envia notificaÃ§Ãµes (ex: email, push) ao usuÃ¡rio alertando sobre transaÃ§Ãµes `due_soon` (a vencer) ou
   `overdue` (vencidas).

### âš ï¸ FA02 - Filtragem por Status

1. O usuÃ¡rio pode aplicar filtros na lista de transaÃ§Ãµes para visualizar apenas aquelas com um status especÃ­fico (ex:
   ver todas as transaÃ§Ãµes `pending` ou `overdue`).

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - TransaÃ§Ã£o/Parcela nÃ£o encontrada

1. Ao tentar atualizar o status de uma transaÃ§Ã£o ou parcela com um ID invÃ¡lido ou inexistente, o sistema exibe uma
   mensagem de erro indicando que o item nÃ£o foi encontrado.

### âš ï¸ FE02 - Saldo Insuficiente (ao marcar despesa como 'Paga')

1. No passo 5 do fluxo principal, se o usuÃ¡rio tentar marcar uma despesa como `paid` e o saldo disponÃ­vel na conta
   associada for insuficiente, o sistema exibe uma mensagem de erro indicando a falta de saldo.
2. O sistema nÃ£o permite a alteraÃ§Ã£o de status e sugere que o usuÃ¡rio ajuste o saldo ou a conta.

### âš ï¸ FE03 - Status InvÃ¡lido

1. Se o usuÃ¡rio tentar atribuir um status invÃ¡lido (que nÃ£o seja `paid`, `pending`, `overdue`, `due_soon`), o sistema
   exibe uma mensagem de erro.

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP - Marcar TransaÃ§Ã£o como Paga

```http
PUT /api/transactions/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678/status HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "status": "paid",
  "payment_date": "2023-10-27"
}
```

### RequisiÃ§Ã£o HTTP - Marcar Parcela como Paga

```http
PUT /api/installment-transactions/installments/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678/status HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "status": "paid",
  "payment_date": "2023-10-27"
}
```

### RequisiÃ§Ã£o HTTP - Obter Resumo de TransaÃ§Ãµes por Status

```http
GET /api/transactions/summary-by-status HTTP/1.1
Host: api.metakyasshu.com
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> --------------------------------------------------------------------------- 