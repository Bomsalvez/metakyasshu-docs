# RF013.2 ðŸ“ˆ AnÃ¡lises financeiras personalizÃ¡veis

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade permite a criaÃ§Ã£o de anÃ¡lises financeiras personalizÃ¡veis (grÃ¡ficos, tabelas, dashboards) para
identificar padrÃµes de gastos, tendÃªncias de receitas e despesas, e oportunidades de economia, oferecendo ao usuÃ¡rio uma
compreensÃ£o aprofundada de sua saÃºde financeira.

## ðŸ‘¥ Atores

- ðŸ‘¤ UsuÃ¡rio Autenticado

## âš ï¸ PrÃ©-condiÃ§Ãµes

- O usuÃ¡rio deve estar logado no sistema.
- O usuÃ¡rio deve ter um histÃ³rico de transaÃ§Ãµes financeiras no sistema.

## ðŸ”Œ Endpoints

- `POST /api/analytics/custom` (para criar anÃ¡lise personalizada)
- `GET /api/analytics/predefined` (para obter tipos de anÃ¡lise predefinidos)
- `GET /api/analytics/{analysisId}` (para visualizar anÃ¡lise salva)

## ðŸ“‹ Dados para AnÃ¡lise Financeira

| Campo           | Tipo     | ObrigatÃ³rio | DescriÃ§Ã£o                                     | RestriÃ§Ãµes                                                 |
|-----------------|----------|-------------|-----------------------------------------------|------------------------------------------------------------|
| `name`          | `string` | âœ… Sim       | Nome da anÃ¡lise personalizada                 | MÃ­nimo de 3 caracteres, Ãºnico para o usuÃ¡rio               |
| `analysis_type` | `string` | âœ… Sim       | Tipo de visualizaÃ§Ã£o                          | `bar_chart`, `line_chart`, `pie_chart`, `table`, `summary` |
| `start_date`    | `string` | âœ… Sim       | Data de inÃ­cio do perÃ­odo da anÃ¡lise          | Formato YYYY-MM-DD                                         |
| `end_date`      | `string` | âœ… Sim       | Data de tÃ©rmino do perÃ­odo da anÃ¡lise         | Formato YYYY-MM-DD, apÃ³s ou igual a `start_date`           |
| `group_by`      | `string` | â¬œ NÃ£o       | Agrupamento dos dados                         | `category`, `month`, `year`, `payment_method`              |
| `filter_by`     | `object` | â¬œ NÃ£o       | Filtros adicionais (categorias, contas, etc.) | Objeto com chaves `category_ids`, `account_ids`, `type`    |

## ðŸ”„ Fluxo Principal - CriaÃ§Ã£o e VisualizaÃ§Ã£o de AnÃ¡lise

```mermaid
sequenceDiagram
    actor U as UsuÃ¡rio
    participant S as Sistema
    participant BD as Banco de Dados
    U->>S: Acessa a seÃ§Ã£o de AnÃ¡lises Financeiras
    S->>U: Exibe opÃ§Ãµes de tipos de anÃ¡lise e filtros
    U->>S: Seleciona tipo de anÃ¡lise, perÃ­odo e filtros/agrupamentos
    S->>S: Valida os parÃ¢metros da anÃ¡lise
    S->>BD: Solicita dados financeiros com base nos filtros
    BD->>S: Retorna dados brutos
    S->>S: Processa dados e gera visualizaÃ§Ã£o (grÃ¡fico/tabela)
    S->>U: Exibe a anÃ¡lise financeira gerada
    U->>S: Salva a anÃ¡lise (opcional)
    S->>BD: Salva configuraÃ§Ã£o da anÃ¡lise
    BD->>S: Confirma salvamento
```

1. O usuÃ¡rio autenticado acessa a seÃ§Ã£o de AnÃ¡lises Financeiras no sistema.
2. O sistema exibe opÃ§Ãµes de anÃ¡lises predefinidas (ex: Despesas por Categoria, Receitas por MÃªs) e a possibilidade de
   criar uma anÃ¡lise personalizada.
3. O usuÃ¡rio seleciona um tipo de visualizaÃ§Ã£o (ex: grÃ¡fico de barras, linha, pizza, tabela, resumo), define um perÃ­odo
   e aplica filtros (ex: por categoria, conta, tipo de transaÃ§Ã£o) ou agrupamentos (ex: por mÃªs, ano).
4. O sistema valida os parÃ¢metros de entrada, garantindo que as datas sÃ£o vÃ¡lidas e que os IDs de filtros existem e
   pertencem ao usuÃ¡rio.
5. O sistema consulta o banco de dados para recuperar as transaÃ§Ãµes e dados financeiros relevantes com base nos filtros
   e agrupamentos selecionados.
6. O sistema processa os dados, realiza os cÃ¡lculos necessÃ¡rios e gera a visualizaÃ§Ã£o (grÃ¡ficos, tabelas) na interface.
7. O usuÃ¡rio pode interagir com a anÃ¡lise (ex: passar o mouse para ver detalhes, ajustar zoom) e, opcionalmente, salvar
   a configuraÃ§Ã£o dessa anÃ¡lise personalizada para acesso futuro.

## ðŸ”€ Fluxos Alternativos

### âš ï¸ FA01 - AnÃ¡lises Salvas e Favoritas

1. O usuÃ¡rio pode acessar uma lista de suas anÃ¡lises personalizadas salvas e marcÃ¡-las como favoritas para acesso
   rÃ¡pido.
2. O sistema exibe um dashboard personalizÃ¡vel onde as anÃ¡lises favoritas podem ser fixadas.

### âš ï¸ FA02 - ExportaÃ§Ã£o de Dados da AnÃ¡lise

1. O usuÃ¡rio pode exportar os dados brutos ou a imagem da anÃ¡lise gerada em formatos como CSV, PDF ou PNG.

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - PerÃ­odo sem dados

1. Se o perÃ­odo selecionado para a anÃ¡lise nÃ£o contiver nenhuma transaÃ§Ã£o ou dado financeiro, o sistema informa ao
   usuÃ¡rio que nÃ£o hÃ¡ dados para o perÃ­odo e nÃ£o gera a anÃ¡lise.

### âš ï¸ FE02 - ParÃ¢metros de anÃ¡lise invÃ¡lidos

1. Se os parÃ¢metros de anÃ¡lise (ex: `analysis_type` desconhecido, `filter_by` com IDs invÃ¡lidos) forem incorretos, o
   sistema exibe uma mensagem de erro indicando o problema.
2. O sistema retorna Ã  tela de configuraÃ§Ã£o da anÃ¡lise para que o usuÃ¡rio corrija os dados.

### âš ï¸ FE03 - Erro na geraÃ§Ã£o da anÃ¡lise

1. Se ocorrer um erro interno no sistema durante o processamento ou a geraÃ§Ã£o da visualizaÃ§Ã£o da anÃ¡lise, o sistema
   exibe uma mensagem de erro genÃ©rica e sugere que o usuÃ¡rio tente novamente mais tarde.

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP - Criar AnÃ¡lise de Despesas por Categoria (GrÃ¡fico de Pizza)

```http
POST /api/analytics/custom HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "name": "Despesas por Categoria - Ãšltimos 3 meses",
  "analysis_type": "pie_chart",
  "start_date": "2023-08-01",
  "end_date": "2023-10-31",
  "group_by": "category",
  "filter_by": {
    "type": "expense"
  }
}
```

### RequisiÃ§Ã£o HTTP - Visualizar AnÃ¡lise Salva

```http
GET /api/analytics/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678 HTTP/1.1
Host: api.metakyasshu.com
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> --------------------------------------------------------------------------- 