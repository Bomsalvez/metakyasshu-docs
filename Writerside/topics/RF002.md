# RF002 ðŸ”‘ Login com email/senha e autenticaÃ§Ã£o multifator

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade permite que o usuÃ¡rio faÃ§a login no sistema utilizando seu email e senha cadastrados. AlÃ©m disso,
oferece a opÃ§Ã£o de configurar e utilizar autenticaÃ§Ã£o multifator (MFA) para uma camada adicional de seguranÃ§a.

## ðŸ‘¥ Atores

- ðŸ‘¤ UsuÃ¡rio Cadastrado

## âš ï¸ PrÃ©-condiÃ§Ãµes

- O usuÃ¡rio deve possuir uma conta cadastrada no sistema.
- Para autenticaÃ§Ã£o multifator, o usuÃ¡rio deve ter configurado previamente um mÃ©todo de MFA.

## ðŸ”Œ Endpoints

- `POST /api/auth/login`
- `POST /api/auth/mfa/setup`
- `POST /api/auth/mfa/verify`

## ðŸ“‹ Dados de Login

| Campo      | Tipo     | ObrigatÃ³rio | DescriÃ§Ã£o                                          | RestriÃ§Ãµes             |
|------------|----------|-------------|----------------------------------------------------|------------------------|
| `email`    | `string` | âœ… Sim       | E-mail do usuÃ¡rio                                  | Formato vÃ¡lido         |
| `password` | `string` | âœ… Sim       | Senha do usuÃ¡rio                                   | MÃ­nimo de 8 caracteres |
| `mfa_code` | `string` | â¬œ NÃ£o       | CÃ³digo de autenticaÃ§Ã£o multifator (se MFA ativado) | 6 dÃ­gitos numÃ©ricos    |

## ðŸ”„ Fluxo Principal

```mermaid
sequenceDiagram
    actor U as UsuÃ¡rio
    participant S as Sistema
    U->>S: Acessa pÃ¡gina de login
    S->>U: Exibe formulÃ¡rio de login
    U->>S: Informa email e senha
    S->>S: Valida credenciais
    alt MFA Ativo
        S->>U: Solicita cÃ³digo MFA
        U->>S: Informa cÃ³digo MFA
        S->>S: Valida cÃ³digo MFA
        S->>U: AutenticaÃ§Ã£o bem-sucedida e redireciona para dashboard
    else MFA Inativo
        S->>U: AutenticaÃ§Ã£o bem-sucedida e redireciona para dashboard
    end
```

1. O usuÃ¡rio acessa a pÃ¡gina de login do sistema.
2. O sistema exibe um formulÃ¡rio solicitando email e senha.
3. O usuÃ¡rio insere seu email e senha e envia o formulÃ¡rio.
4. O sistema valida as credenciais fornecidas.
5. Se a autenticaÃ§Ã£o multifator estiver ativada para o usuÃ¡rio, o sistema solicita o cÃ³digo MFA.
6. O usuÃ¡rio insere o cÃ³digo MFA.
7. O sistema valida o cÃ³digo MFA.
8. ApÃ³s a validaÃ§Ã£o bem-sucedida (seja apenas com senha ou com MFA), o sistema autentica o usuÃ¡rio e o redireciona para
   a pÃ¡gina principal (dashboard).

## ðŸ”€ Fluxos Alternativos

### âš ï¸ FA01 - ConfiguraÃ§Ã£o de AutenticaÃ§Ã£o Multifator

1. No fluxo principal, apÃ³s o login bem-sucedido, o usuÃ¡rio pode ser direcionado para uma pÃ¡gina de configuraÃ§Ã£o de MFA,
   caso ainda nÃ£o tenha ativado.
2. O sistema exibe as opÃ§Ãµes de MFA (ex: aplicativo autenticador, SMS).
3. O usuÃ¡rio seleciona e configura seu mÃ©todo preferido, seguindo as instruÃ§Ãµes do sistema.
4. O sistema confirma a ativaÃ§Ã£o do MFA para a conta do usuÃ¡rio.

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - Credenciais InvÃ¡lidas

1. No passo 4 do fluxo principal, se as credenciais (email/senha) forem invÃ¡lidas, o sistema exibe uma mensagem de erro
   indicando que o email ou a senha estÃ£o incorretos.
2. O sistema mantÃ©m o usuÃ¡rio na pÃ¡gina de login para que ele possa tentar novamente.

### âš ï¸ FE02 - CÃ³digo MFA InvÃ¡lido ou Expirado

1. No passo 7 do fluxo principal, se o cÃ³digo MFA informado for invÃ¡lido ou tiver expirado, o sistema exibe uma mensagem
   de erro.
2. O sistema solicita que o usuÃ¡rio insira um novo cÃ³digo MFA ou utilize uma opÃ§Ã£o de recuperaÃ§Ã£o.

### âš ï¸ FE03 - Conta Bloqueada apÃ³s MÃºltiplas Tentativas Falhas

1. Se houver um nÃºmero excessivo de tentativas de login falhas (seja por senha ou MFA), o sistema pode bloquear
   temporariamente a conta do usuÃ¡rio por seguranÃ§a.
2. O sistema exibe uma mensagem informando que a conta foi bloqueada e as instruÃ§Ãµes para desbloqueio (ex: esperar um
   tempo, entrar em contato com o suporte).

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP - Login com Email e Senha

```http
POST /api/auth/login HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json

{
  "email": "usuario@example.com",
  "password": "MinhaSenhaSegura123"
}
```

### RequisiÃ§Ã£o HTTP - Login com MFA

```http
POST /api/auth/login HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json

{
  "email": "usuario@example.com",
  "password": "MinhaSenhaSegura123",
  "mfa_code": "123456"
}
```

### RequisiÃ§Ã£o HTTP - ConfiguraÃ§Ã£o de MFA (Exemplo simplificado)

```http
POST /api/auth/mfa/setup HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "method": "authenticator_app"
}
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> --------------------------------------------------------------------------- 