# RF023.2 ðŸ’° Acompanhamento de emprÃ©stimos e dÃ­vidas

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade permite o acompanhamento do status de emprÃ©stimos e dÃ­vidas entre membros. Os usuÃ¡rios podem
visualizar o saldo pendente, histÃ³rico de pagamentos, datas de vencimento e receber lembretes, proporcionando uma visÃ£o
clara de suas obrigaÃ§Ãµes financeiras e recebÃ­veis.

## ðŸ‘¥ Atores

- ðŸ‘¤ **Credor**: O usuÃ¡rio que emprestou dinheiro e deseja acompanhar o recebimento.
- ðŸ‘¤ **Devedor**: O usuÃ¡rio que pegou dinheiro emprestado e deseja acompanhar sua dÃ­vida.

## âš ï¸ PrÃ©-condiÃ§Ãµes

- O usuÃ¡rio deve estar autenticado no sistema.
- Deve existir emprÃ©stimos ou dÃ­vidas registrados envolvendo o usuÃ¡rio.

## ðŸ”Œ Endpoints

- `GET /api/users/{userId}/loans-debts` (Listar todos os emprÃ©stimos/dÃ­vidas do usuÃ¡rio)
- `GET /api/loans-debts/{loanDebtId}` (Obter detalhes de um emprÃ©stimo/dÃ­vida especÃ­fico)

## ðŸ“‹ Dados de EmprÃ©stimo/DÃ­vida para Acompanhamento

| Campo             | Tipo                | DescriÃ§Ã£o                                     | Status PossÃ­veis             |
|-------------------|---------------------|-----------------------------------------------|------------------------------|
| `loanDebtId`      | `string`            | ID Ãºnico do emprÃ©stimo/dÃ­vida.                | N/A                          |
| `lenderId`        | `string`            | ID do usuÃ¡rio credor.                         | N/A                          |
| `borrowerId`      | `string`            | ID do usuÃ¡rio devedor.                        | N/A                          |
| `amount`          | `number`            | Valor total do emprÃ©stimo/dÃ­vida.             | N/A                          |
| `currentBalance`  | `number`            | Saldo atual pendente.                         | N/A                          |
| `currency`        | `string`            | Moeda do emprÃ©stimo/dÃ­vida.                   | N/A                          |
| `dueDate`         | `string` (ISO 8601) | Data de vencimento.                           | N/A                          |
| `interestRate`    | `number`            | Taxa de juros anual (se aplicÃ¡vel).           | N/A                          |
| `description`     | `string`            | DescriÃ§Ã£o do emprÃ©stimo/dÃ­vida.               | N/A                          |
| `status`          | `string`            | Status atual do emprÃ©stimo/dÃ­vida.            | `PENDING`, `PAID`, `OVERDUE` |
| `paymentsHistory` | `array`             | HistÃ³rico de pagamentos (data, valor, notas). | N/A                          |

## ðŸ”„ Fluxo Principal - VisualizaÃ§Ã£o de EmprÃ©stimos e DÃ­vidas

```mermaid
sequenceDiagram
    actor U as UsuÃ¡rio
    participant S as Sistema
    U ->> S: 1. Solicita visualizar lista de emprÃ©stimos/dÃ­vidas (GET /api/users/{userId}/loans-debts)
    S ->> S: 2. Consulta emprÃ©stimos e dÃ­vidas associados ao userId
    S ->> S: 3. Calcula `currentBalance` e `status` para cada um
    S ->> U: 4. Retorna lista de emprÃ©stimos/dÃ­vidas com detalhes (HTTP 200 OK)
```

1. O UsuÃ¡rio (seja credor ou devedor) envia uma requisiÃ§Ã£o GET para `/api/users/{userId}/loans-debts` para obter uma
   lista de todas as transaÃ§Ãµes de emprÃ©stimo/dÃ­vida em que estÃ¡ envolvido.
2. O sistema consulta o banco de dados para encontrar todos os registros onde o `userId` Ã© `lenderId` ou `borrowerId`.
3. Para cada emprÃ©stimo/dÃ­vida, o sistema calcula o `currentBalance` (saldo pendente) com base no `amount` original e no
   `paymentsHistory`, e determina o `status` (`PENDING`, `PAID`, `OVERDUE`).
4. O sistema retorna uma resposta HTTP 200 OK contendo uma lista de objetos de emprÃ©stimo/dÃ­vida, cada um com seus
   detalhes completos, incluindo saldo atual e status.

## ðŸ”€ Fluxos Alternativos

### âš ï¸ FA01 - Filtragem por Status

1. O usuÃ¡rio pode adicionar parÃ¢metros de query Ã  requisiÃ§Ã£o (e.g., `?status=OVERDUE`) para filtrar a lista.
2. O sistema retorna apenas os emprÃ©stimos/dÃ­vidas que correspondem ao status filtrado.

### âš ï¸ FA02 - Detalhes de um EmprÃ©stimo EspecÃ­fico

1. O usuÃ¡rio solicita detalhes de um `loanDebtId` especÃ­fico (GET /api/loans-debts/{loanDebtId}).
2. O sistema retorna todos os dados detalhados daquele emprÃ©stimo/dÃ­vida, incluindo histÃ³rico completo de pagamentos.

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - UsuÃ¡rio NÃ£o Autorizado

1. Um usuÃ¡rio tenta acessar emprÃ©stimos/dÃ­vidas de outro `userId` sem permissÃ£o.
2. O sistema retorna uma resposta HTTP 403 Forbidden.

### âš ï¸ FE02 - EmprÃ©stimo/DÃ­vida NÃ£o Encontrada

1. Ao tentar obter detalhes de um `loanDebtId` especÃ­fico, ele nÃ£o Ã© encontrado.
2. O sistema retorna uma resposta HTTP 404 Not Found.

### âš ï¸ FE03 - AusÃªncia de EmprÃ©stimos/DÃ­vidas

1. O `userId` nÃ£o possui emprÃ©stimos ou dÃ­vidas registrados.
2. O sistema retorna uma lista vazia e um HTTP 200 OK.

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP para Listar Todos os EmprÃ©stimos/DÃ­vidas do UsuÃ¡rio

```http
GET /api/users/usr_abc123/loans-debts HTTP/1.1
Host: api.metakyasshu.com
```

### RequisiÃ§Ã£o HTTP para Listar DÃ­vidas Vencidas de um UsuÃ¡rio

```http
GET /api/users/usr_abc123/loans-debts?status=OVERDUE HTTP/1.1
Host: api.metakyasshu.com
```

### RequisiÃ§Ã£o HTTP para Obter Detalhes de um EmprÃ©stimo EspecÃ­fico

```http
GET /api/loans-debts/lnd_xyz789 HTTP/1.1
Host: api.metakyasshu.com
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> --------------------------------------------------------------------------- 