# RF009.1 ðŸ”„ CriaÃ§Ã£o e gestÃ£o de transaÃ§Ãµes recorrentes

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade permite a criaÃ§Ã£o e gestÃ£o de transaÃ§Ãµes que se repetem periodicamente (ex: aluguel, salÃ¡rio,
assinaturas), facilitando o planejamento e controle financeiro do usuÃ¡rio.

## ðŸ‘¥ Atores

- ðŸ‘¤ UsuÃ¡rio Autenticado

## âš ï¸ PrÃ©-condiÃ§Ãµes

- O usuÃ¡rio deve estar logado no sistema.
- O usuÃ¡rio deve ter categorias e formas de pagamento configuradas.

## ðŸ”Œ Endpoints

- `POST /api/recurring-transactions`
- `GET /api/recurring-transactions`
- `GET /api/recurring-transactions/{recurringTransactionId}`
- `PUT /api/recurring-transactions/{recurringTransactionId}`
- `DELETE /api/recurring-transactions/{recurringTransactionId}`

## ðŸ“‹ Dados da TransaÃ§Ã£o Recorrente

| Campo               | Tipo     | ObrigatÃ³rio | DescriÃ§Ã£o                                   | RestriÃ§Ãµes                                |
|---------------------|----------|-------------|---------------------------------------------|-------------------------------------------|
| `type`              | `string` | âœ… Sim       | Tipo de transaÃ§Ã£o (receita/despesa)         | `revenue`, `expense`                      |
| `amount`            | `number` | âœ… Sim       | Valor da transaÃ§Ã£o recorrente               | Valor positivo, com duas casas decimais   |
| `description`       | `string` | âœ… Sim       | DescriÃ§Ã£o da transaÃ§Ã£o                      | MÃ­nimo de 3 caracteres                    |
| `category_id`       | `string` | âœ… Sim       | ID da categoria da transaÃ§Ã£o                | UUID vÃ¡lido, categoria existente          |
| `payment_method_id` | `string` | âœ… Sim       | ID da forma de pagamento utilizada          | UUID vÃ¡lido, forma de pagamento existente |
| `account_id`        | `string` | âœ… Sim       | ID da conta/carteira envolvida na transaÃ§Ã£o | UUID vÃ¡lido, conta/carteira existente     |
| `frequency`         | `string` | âœ… Sim       | FrequÃªncia da recorrÃªncia                   | `daily`, `weekly`, `monthly`, `yearly`    |
| `start_date`        | `string` | âœ… Sim       | Data de inÃ­cio da recorrÃªncia               | Formato YYYY-MM-DD, nÃ£o futura            |
| `end_date`          | `string` | â¬œ NÃ£o       | Data de tÃ©rmino da recorrÃªncia              | Formato YYYY-MM-DD, apÃ³s `start_date`     |
| `occurrences_limit` | `number` | â¬œ NÃ£o       | Limite de ocorrÃªncias da transaÃ§Ã£o          | NÃºmero inteiro positivo                   |

## ðŸ”„ Fluxo Principal - CriaÃ§Ã£o de TransaÃ§Ã£o Recorrente

```mermaid
sequenceDiagram
    actor U as UsuÃ¡rio
    participant S as Sistema
    participant BD as Banco de Dados
    U->>S: Acessa a seÃ§Ã£o de transaÃ§Ãµes recorrentes
    S->>U: Exibe formulÃ¡rio para nova transaÃ§Ã£o recorrente
    U->>S: Preenche dados (tipo, valor, descriÃ§Ã£o, categoria, forma de pagamento, conta, frequÃªncia, data de inÃ­cio, data de tÃ©rmino/limite)
    S->>S: Valida os dados da transaÃ§Ã£o recorrente
    S->>BD: Salva a nova transaÃ§Ã£o recorrente
    BD->>S: Confirma o salvamento
    S->>U: Exibe mensagem de sucesso e a transaÃ§Ã£o recorrente na lista
```

1. O usuÃ¡rio autenticado acessa a seÃ§Ã£o de gerenciamento de transaÃ§Ãµes recorrentes.
2. O sistema exibe um formulÃ¡rio para a criaÃ§Ã£o de uma nova transaÃ§Ã£o recorrente.
3. O usuÃ¡rio preenche os dados, incluindo: tipo (receita/despesa), valor, descriÃ§Ã£o, categoria, forma de pagamento,
   conta envolvida, frequÃªncia da recorrÃªncia (diÃ¡ria, semanal, mensal, anual), data de inÃ­cio e, opcionalmente, uma
   data de tÃ©rmino ou um limite de ocorrÃªncias.
4. O sistema valida os dados informados, garantindo a consistÃªncia e a validade (ex: datas vÃ¡lidas, frequÃªncia
   reconhecida).
5. O sistema salva as informaÃ§Ãµes da nova transaÃ§Ã£o recorrente no banco de dados.
6. O sistema exibe uma mensagem de confirmaÃ§Ã£o de sucesso e a nova transaÃ§Ã£o recorrente Ã© adicionada Ã  lista do usuÃ¡rio,
   com as prÃ³ximas ocorrÃªncias programadas.

## ðŸ”„ Fluxo Principal - GestÃ£o de TransaÃ§Ãµes Recorrentes

```mermaid
sequenceDiagram
    actor U as UsuÃ¡rio
    participant S as Sistema
    participant BD as Banco de Dados
    U->>S: Acessa a seÃ§Ã£o de transaÃ§Ãµes recorrentes
    S->>BD: Solicita lista de transaÃ§Ãµes recorrentes do usuÃ¡rio
    BD->>S: Retorna lista de transaÃ§Ãµes
    S->>U: Exibe a lista de transaÃ§Ãµes recorrentes
    U->>S: Seleciona transaÃ§Ã£o para visualizar/editar/excluir
    alt Visualizar TransaÃ§Ã£o
        S->>BD: Solicita detalhes da transaÃ§Ã£o
        BD->>S: Retorna detalhes
        S->>U: Exibe detalhes da transaÃ§Ã£o selecionada
    else Editar TransaÃ§Ã£o
        S->>U: Exibe formulÃ¡rio de ediÃ§Ã£o com dados atuais
        U->>S: Altera os dados e envia
        S->>S: Valida dados atualizados
        S->>BD: Atualiza transaÃ§Ã£o recorrente
        BD->>S: Confirma atualizaÃ§Ã£o
        S->>U: Exibe sucesso e transaÃ§Ã£o atualizada
    else Excluir TransaÃ§Ã£o
        S->>U: Solicita confirmaÃ§Ã£o de exclusÃ£o
        U->>S: Confirma exclusÃ£o
        S->>BD: Remove transaÃ§Ã£o recorrente
        BD->>S: Confirma remoÃ§Ã£o
        S->>U: Exibe sucesso e remove transaÃ§Ã£o da lista
    end
```

1. O usuÃ¡rio autenticado acessa a seÃ§Ã£o de gerenciamento de transaÃ§Ãµes recorrentes.
2. O sistema exibe uma lista de todas as transaÃ§Ãµes recorrentes cadastradas pelo usuÃ¡rio.
3. O usuÃ¡rio seleciona uma opÃ§Ã£o: visualizar detalhes, editar ou excluir uma transaÃ§Ã£o recorrente existente.
4. **Para VisualizaÃ§Ã£o:** O sistema exibe os detalhes completos da transaÃ§Ã£o recorrente, incluindo as prÃ³ximas
   ocorrÃªncias.
5. **Para EdiÃ§Ã£o:**
   a. O sistema apresenta um formulÃ¡rio prÃ©-preenchido com os dados atuais da transaÃ§Ã£o recorrente.
   b. O usuÃ¡rio modifica os campos desejados (ex: valor, descriÃ§Ã£o, frequÃªncia, data de tÃ©rmino) e submete as
   alteraÃ§Ãµes.
   c. O sistema valida os novos dados e atualiza a transaÃ§Ã£o recorrente no banco de dados, ajustando as futuras
   ocorrÃªncias se necessÃ¡rio.
   d. O sistema exibe uma mensagem de sucesso e a lista de transaÃ§Ãµes recorrentes atualizada.
6. **Para ExclusÃ£o:**
   a. O sistema solicita uma confirmaÃ§Ã£o do usuÃ¡rio para a exclusÃ£o da transaÃ§Ã£o recorrente.
   b. ApÃ³s a confirmaÃ§Ã£o, o sistema remove a transaÃ§Ã£o recorrente e todas as suas futuras ocorrÃªncias do banco de dados.
   c. O sistema exibe uma mensagem de sucesso e a transaÃ§Ã£o Ã© removida da lista.

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - Dados invÃ¡lidos

1. Durante a criaÃ§Ã£o ou ediÃ§Ã£o, se os dados informados forem invÃ¡lidos (ex: valor negativo, data de tÃ©rmino anterior Ã 
   data de inÃ­cio, `category_id` inexistente), o sistema exibe uma mensagem de erro especÃ­fica para o campo invÃ¡lido.
2. O sistema retorna ao formulÃ¡rio para que o usuÃ¡rio corrija os dados.

### âš ï¸ FE02 - TransaÃ§Ã£o Recorrente nÃ£o encontrada

1. Ao tentar visualizar, editar ou excluir uma transaÃ§Ã£o recorrente com um `recurringTransactionId` invÃ¡lido, o sistema
   exibe uma mensagem de erro indicando que a transaÃ§Ã£o nÃ£o foi encontrada.

### âš ï¸ FE03 - Erro ao salvar/atualizar/excluir

1. Se ocorrer um erro interno no sistema durante as operaÃ§Ãµes de salvar, atualizar ou excluir a transaÃ§Ã£o recorrente, o
   sistema exibe uma mensagem de erro genÃ©rica e sugere que o usuÃ¡rio tente novamente mais tarde.

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP - Criar TransaÃ§Ã£o Recorrente (Mensal)

```http
POST /api/recurring-transactions HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "type": "expense",
  "amount": 1200.00,
  "description": "Aluguel",
  "category_id": "uuid-da-categoria-moradia",
  "payment_method_id": "uuid-da-forma-pagamento-boleto",
  "account_id": "uuid-da-conta-corrente",
  "frequency": "monthly",
  "start_date": "2023-11-01"
}
```

### RequisiÃ§Ã£o HTTP - Listar TransaÃ§Ãµes Recorrentes

```http
GET /api/recurring-transactions HTTP/1.1
Host: api.metakyasshu.com
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]
```

### RequisiÃ§Ã£o HTTP - Atualizar TransaÃ§Ã£o Recorrente

```http
PUT /api/recurring-transactions/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678 HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "amount": 1250.00,
  "description": "Aluguel (reajustado)"
}
```

### RequisiÃ§Ã£o HTTP - Excluir TransaÃ§Ã£o Recorrente

```http
DELETE /api/recurring-transactions/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678 HTTP/1.1
Host: api.metakyasshu.com
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> ---------------------------------------------------------------------------