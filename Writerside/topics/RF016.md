# RF016 ðŸ“¨ Convite de membros para grupos

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade permite que o administrador de um grupo financeiro envie convites para novos membros via e-mail ou
link compartilhÃ¡vel. Os convites sÃ£o unilaterais, o que significa que o convidado precisa aceitar o convite para se
juntar ao grupo.

## ðŸ‘¥ Atores

- ðŸ‘¤ Administrador do Grupo
- ðŸ‘¤ UsuÃ¡rio Convidado
- ðŸ“§ Sistema de NotificaÃ§Ã£o/E-mail

## âš ï¸ PrÃ©-condiÃ§Ãµes

- O administrador deve estar logado no sistema.
- O grupo financeiro colaborativo deve existir e o usuÃ¡rio deve ser seu administrador.
- O usuÃ¡rio convidado pode ou nÃ£o ter uma conta existente no sistema.

## ðŸ”Œ Endpoints

- `POST /api/groups/{groupId}/invites` (Enviar convite por email ou gerar link)
- `PUT /api/invites/{inviteId}/accept` (Aceitar convite)
- `PUT /api/invites/{inviteId}/reject` (Rejeitar convite)
- `GET /api/invites/me` (Listar convites pendentes para o usuÃ¡rio)

## ðŸ“‹ Dados para Convite de Membros

| Campo         | Tipo     | ObrigatÃ³rio                    | DescriÃ§Ã£o                                       | RestriÃ§Ãµes                     |
|---------------|----------|--------------------------------|-------------------------------------------------|--------------------------------|
| `groupId`     | `string` | âœ… Sim                          | ID do grupo para o qual o membro serÃ¡ convidado | UUID vÃ¡lido, grupo existente   |
| `invite_type` | `string` | âœ… Sim                          | Tipo de convite                                 | `email`, `link`                |
| `email`       | `string` | âœ… Sim (se `email` invite_type) | E-mail do usuÃ¡rio a ser convidado               | Formato de e-mail vÃ¡lido       |
| `role`        | `string` | âœ… Sim                          | Papel do usuÃ¡rio no grupo                       | `member`, `admin`              |
| `invite_link` | `string` | â¬œ NÃ£o (retorno)                | Link de convite gerado                          | URL vÃ¡lida                     |
| `inviteId`    | `string` | âœ… Sim (para aceitar/rejeitar)  | ID do convite especÃ­fico                        | UUID vÃ¡lido, convite existente |

## ðŸ”„ Fluxo Principal - Envio de Convite por E-mail

```mermaid
sequenceDiagram
    actor A as Administrador
    participant S as Sistema
    participant BD as Banco de Dados
    participant E as ServiÃ§o de Email
    A->>S: Seleciona "Convidar Membro" em um grupo
    S->>A: Exibe formulÃ¡rio de convite (opÃ§Ã£o por email)
    A->>S: Informa email do convidado e papel no grupo
    S->>S: Valida dados e gera token de convite
    S->>BD: Salva convite pendente
    BD->>S: Confirma salvamento
    S->>E: Envia email com link de convite e token
    E->>U: Email entregue ao UsuÃ¡rio Convidado
    U->>U: Clica no link do email
    U->>S: Redirecionado para pÃ¡gina de aceitaÃ§Ã£o/criaÃ§Ã£o de conta
    alt UsuÃ¡rio Convidado nÃ£o tem conta
        S->>U: Exibe pÃ¡gina de cadastro/login com convite prÃ©-preenchido
        U->>S: Cadastra-se/Loga-se e aceita convite
        S->>BD: Cria conta/Vincula convite Ã  conta e adiciona ao grupo
    else UsuÃ¡rio Convidado jÃ¡ tem conta
        S->>U: Exibe pÃ¡gina de aceitaÃ§Ã£o do convite
        U->>S: Aceita convite
        S->>BD: Adiciona usuÃ¡rio ao grupo
    end
    BD->>S: Confirma adiÃ§Ã£o ao grupo
    S->>A: Notifica Administrador sobre aceitaÃ§Ã£o
    S->>U: Redireciona para o grupo
```

1. O administrador do grupo acessa a opÃ§Ã£o "Convidar Membro" para um grupo especÃ­fico.
2. O sistema oferece a opÃ§Ã£o de convidar por e-mail.
3. O administrador informa o e-mail do usuÃ¡rio a ser convidado e o papel que ele terÃ¡ no grupo (ex: `member` padrÃ£o).
4. O sistema valida o e-mail, gera um token de convite Ãºnico e salva o convite como pendente no banco de dados.
5. O sistema envia um e-mail para o endereÃ§o fornecido, contendo um link de convite com o token.
6. O usuÃ¡rio convidado recebe o e-mail e clica no link. Se o usuÃ¡rio jÃ¡ tiver uma conta, ele serÃ¡ direcionado para uma
   pÃ¡gina de aceitaÃ§Ã£o. Se nÃ£o tiver, serÃ¡ direcionado para uma pÃ¡gina de cadastro/login onde o convite jÃ¡ estarÃ¡
   associado.
7. ApÃ³s aceitar o convite (e, se necessÃ¡rio, criar/logar na conta), o sistema adiciona o usuÃ¡rio ao grupo com o papel
   definido.
8. O sistema notifica o administrador sobre a aceitaÃ§Ã£o do convite e o novo membro passa a ter acesso ao grupo.

## ðŸ”„ Fluxo Principal - GeraÃ§Ã£o de Link de Convite

```mermaid
sequenceDiagram
    actor A as Administrador
    participant S as Sistema
    participant BD as Banco de Dados
    A->>S: Seleciona "Convidar Membro" em um grupo
    S->>A: Exibe formulÃ¡rio de convite (opÃ§Ã£o por link)
    A->>S: Seleita a opÃ§Ã£o de gerar link e define papel no grupo
    S->>S: Gera token de convite e link compartilhÃ¡vel
    S->>BD: Salva convite pendente (associado ao link)
    BD->>S: Confirma salvamento
    S->>A: Exibe o link de convite para o Administrador copiar
    A->>U: Administrador compartilha o link com UsuÃ¡rio Convidado (fora do sistema)
    U->>U: Clica no link
    U->>S: Redirecionado para pÃ¡gina de aceitaÃ§Ã£o/criaÃ§Ã£o de conta (similar ao fluxo de email)
```

1. O administrador do grupo acessa a opÃ§Ã£o "Convidar Membro" para um grupo especÃ­fico.
2. O sistema oferece a opÃ§Ã£o de gerar um link de convite compartilhÃ¡vel.
3. O administrador seleciona essa opÃ§Ã£o e define o papel que os usuÃ¡rios que usarem o link terÃ£o no grupo (ex:
   `member`).
4. O sistema gera um token de convite Ãºnico e um link URL. O convite Ã© salvo como pendente.
5. O sistema exibe o link para o administrador, que pode copiÃ¡-lo e compartilhÃ¡-lo manualmente com os futuros membros (
   ex: via WhatsApp, Slack).
6. Qualquer usuÃ¡rio que acessar o link serÃ¡ direcionado para a pÃ¡gina de aceitaÃ§Ã£o/cadastro, similar ao fluxo de e-mail.
7. ApÃ³s a aceitaÃ§Ã£o, o usuÃ¡rio Ã© adicionado ao grupo.

## ðŸ”€ Fluxos Alternativos

### âš ï¸ FA01 - Reenvio de Convite / GeraÃ§Ã£o de Novo Link

1. O administrador pode reenviar um convite por e-mail ou gerar um novo link caso o anterior tenha expirado ou nÃ£o tenha
   sido recebido.

### âš ï¸ FA02 - Cancelamento de Convite

1. O administrador pode cancelar um convite pendente a qualquer momento, invalidando o token ou link associado.

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - Grupo nÃ£o encontrado

1. Se o `groupId` fornecido para enviar o convite for invÃ¡lido, o sistema exibe uma mensagem de erro indicando que o
   grupo nÃ£o foi encontrado.

### âš ï¸ FE02 - E-mail jÃ¡ membro do grupo / convite pendente

1. Se o e-mail informado para convite jÃ¡ pertencer a um membro do grupo ou jÃ¡ tiver um convite pendente para o mesmo
   grupo, o sistema informa ao administrador sobre a duplicidade e nÃ£o envia um novo convite.

### âš ï¸ FE03 - Erro no envio de e-mail

1. Se ocorrer uma falha no serviÃ§o de envio de e-mail, o sistema informa ao administrador que o e-mail nÃ£o pÃ´de ser
   enviado, mas o convite ainda pode ser aceito por link ou reenvio.

### âš ï¸ FE04 - Convite Expirado/InvÃ¡lido (na aceitaÃ§Ã£o)

1. Se o usuÃ¡rio convidado tentar aceitar um convite cujo token ou link jÃ¡ expirou ou Ã© invÃ¡lido, o sistema exibe uma
   mensagem de erro e pode sugerir que ele solicite um novo convite ao administrador do grupo.

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP - Enviar Convite por E-mail

```http
POST /api/groups/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678/invites HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "invite_type": "email",
  "email": "convidado@example.com",
  "role": "member"
}
```

### RequisiÃ§Ã£o HTTP - Gerar Link de Convite

```http
POST /api/groups/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678/invites HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "invite_type": "link",
  "role": "member"
}
```

### RequisiÃ§Ã£o HTTP - Aceitar Convite

```http
PUT /api/invites/uuid-do-convite-gerado/accept HTTP/1.1
Host: api.metakyasshu.com
Authorization: Bearer [TOKEN_DE_AUTENTICACAO] (se usuÃ¡rio jÃ¡ logado)
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> --------------------------------------------------------------------------- 