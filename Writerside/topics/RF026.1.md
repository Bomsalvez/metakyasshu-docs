# RF026.1 ðŸ“± Scanner de QR codes para transaÃ§Ãµes

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade permite o uso de scanner de QR codes para registro rÃ¡pido de transaÃ§Ãµes, tanto para pagamentos
quanto para recebimentos. Ao escanear um QR code (por exemplo, de um Pix, boleto ou outro formato suportado), o
aplicativo preenche automaticamente os detalhes da transaÃ§Ã£o, agilizando o processo e reduzindo erros de digitaÃ§Ã£o.

## ðŸ‘¥ Atores

- ðŸ‘¤ **UsuÃ¡rio**: O indivÃ­duo que utiliza a cÃ¢mera do dispositivo para escanear um QR code financeiro.

## âš ï¸ PrÃ©-condiÃ§Ãµes

- O usuÃ¡rio deve estar autenticado no sistema.
- O dispositivo do usuÃ¡rio deve ter uma cÃ¢mera funcional e permissÃ£o concedida ao aplicativo para acessÃ¡-la.
- O QR code deve ser de um formato financeiro reconhecido e vÃ¡lido (e.g., Pix copia e cola, boleto bancÃ¡rio).

## ðŸ”Œ Endpoints

- `POST /api/transactions/qr-scan` (Processar QR Code e Sugerir TransaÃ§Ã£o)

## ðŸ“‹ Dados de Processamento de QR Code

| Campo           | Tipo     | ObrigatÃ³rio | DescriÃ§Ã£o                      | RestriÃ§Ãµes                                   |
|-----------------|----------|-------------|--------------------------------|----------------------------------------------|
| `qrCodeContent` | `string` | âœ… Sim       | ConteÃºdo do QR code escaneado. | Deve ser um string decodificÃ¡vel do QR code. |

## ðŸ“‹ Dados de SaÃ­da (SugestÃ£o de TransaÃ§Ã£o)

| Campo                  | Tipo     | DescriÃ§Ã£o                                                | RestriÃ§Ãµes                                                                               |
|------------------------|----------|----------------------------------------------------------|------------------------------------------------------------------------------------------|
| `suggestedTransaction` | `object` | Objeto JSON com os detalhes da transaÃ§Ã£o prÃ©-preenchida. | Pode incluir campos como `amount`, `description`, `recipientName`, `paymentMethod`, etc. |
| `status`               | `string` | Status do processamento.                                 | Valores: `SUCCESS`, `INVALID_QR`, `PROCESSING_ERROR`.                                    |
| `message`              | `string` | Mensagem descritiva do resultado.                        | N/A                                                                                      |

## ðŸ”„ Fluxo Principal

```mermaid
sequenceDiagram
    actor U as UsuÃ¡rio
    participant A as Aplicativo
    participant S as Sistema
    U ->> A: 1. Abre a funcionalidade de scanner de QR code
    A ->> U: 2. Ativa a cÃ¢mera e exibe a interface de scanner
    U ->> A: 3. Escaneia um QR code financeiro
    A ->> S: 4. Envia o conteÃºdo do QR code para processamento (POST /api/transactions/qr-scan)
    S ->> S: 5. Decodifica e extrai dados financeiros do QR code
    S ->> A: 6. Retorna uma sugestÃ£o de transaÃ§Ã£o prÃ©-preenchida
    A ->> U: 7. Exibe a tela de confirmaÃ§Ã£o de transaÃ§Ã£o com os campos preenchidos
    U ->> A: 8. (Opcional) Edita ou confirma a transaÃ§Ã£o
    A ->> S: 9. Envia a transaÃ§Ã£o finalizada (para RF relevante, ex: criaÃ§Ã£o de transaÃ§Ã£o)
    S ->> A: 10. Retorna confirmaÃ§Ã£o de transaÃ§Ã£o registrada
```

1. O UsuÃ¡rio abre a funcionalidade de scanner de QR code no aplicativo.
2. O aplicativo ativa a cÃ¢mera do dispositivo e exibe uma interface para o escaneamento.
3. O UsuÃ¡rio posiciona o dispositivo para escanear um QR code financeiro (ex: de um boleto ou um cÃ³digo Pix).
4. ApÃ³s o escaneamento bem-sucedido, o aplicativo envia o conteÃºdo textual do QR code para o endpoint
   `POST /api/transactions/qr-scan`.
5. O sistema backend decodifica o conteÃºdo do QR code e extrai os dados financeiros relevantes (e.g., valor,
   destinatÃ¡rio, descriÃ§Ã£o, banco).
6. O sistema retorna uma sugestÃ£o de objeto de transaÃ§Ã£o prÃ©-preenchida para o aplicativo.
7. O aplicativo exibe uma tela de confirmaÃ§Ã£o da transaÃ§Ã£o, com os campos preenchidos automaticamente com os dados
   extraÃ­dos do QR code.
8. O UsuÃ¡rio pode revisar, editar os campos (se necessÃ¡rio) e confirmar a transaÃ§Ã£o.
9. O aplicativo envia a transaÃ§Ã£o finalizada para o endpoint apropriado (e.g., `POST /api/transactions` ou
   `POST /api/payments`).
10. O sistema registra a transaÃ§Ã£o e retorna uma confirmaÃ§Ã£o de sucesso.

## ðŸ”€ Fluxos Alternativos

### âš ï¸ FA01 - QR Code de Texto Puro (Copia e Cola)

1. Se o QR code contiver apenas texto puro (e.g., um cÃ³digo Pix copia e cola), o aplicativo pode oferecer a opÃ§Ã£o de
   colar o texto diretamente.
2. O fluxo segue o mesmo caminho de processamento do conteÃºdo do QR code.

### âš ï¸ FA02 - MÃºltiplos Tipos de QR Code

1. O sistema backend pode identificar diferentes formatos de QR code (Pix, boleto, voucher) e adaptar a extraÃ§Ã£o e
   preenchimento dos dados.
2. Para cada tipo, o `suggestedTransaction` terÃ¡ campos especÃ­ficos preenchidos.

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - QR Code InvÃ¡lido ou NÃ£o Reconhecido

1. O QR code escaneado Ã© ilegÃ­vel, nÃ£o contÃ©m dados financeiros vÃ¡lidos ou o formato nÃ£o Ã© suportado.
2. O sistema retorna um `status: INVALID_QR` e uma mensagem de erro.
3. O aplicativo exibe uma mensagem de erro ao usuÃ¡rio e solicita que tente novamente com um QR code vÃ¡lido.

### âš ï¸ FE02 - Falha na Leitura da CÃ¢mera

1. O aplicativo nÃ£o consegue acessar a cÃ¢mera ou o QR code nÃ£o Ã© bem focado/iluminado.
2. O aplicativo exibe uma mensagem de erro ao usuÃ¡rio sobre a falha na leitura e o orienta a tentar novamente.

### âš ï¸ FE03 - Erro no Processamento Backend

1. O backend enfrenta um erro ao decodificar ou extrair informaÃ§Ãµes do QR code.
2. O sistema retorna um `status: PROCESSING_ERROR`.
3. O aplicativo informa ao usuÃ¡rio sobre um erro interno e sugere que tente novamente ou insira os dados manualmente.

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP para Processar um QR Code (ConteÃºdo do Pix Copia e Cola)

```http
POST /api/transactions/qr-scan HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json

{
  "qrCodeContent": "00020126580014BR.GOV.BCB.PIX0136a3e1b2c3-d4e5-f6a7-b8c9-0d1e2f3a4b5c5204000053039865802BR5915NOME DO PAGADOR6008BRASILIA62070503***6304CA1A"
}
```

### Exemplo de Resposta (SugestÃ£o de TransaÃ§Ã£o Pix)

```json
{
  "suggestedTransaction": {
    "type": "RECEIVABLE",
    "amount": 150.00,
    "currency": "BRL",
    "description": "Pagamento de almoÃ§o",
    "recipientName": "Maria Silva",
    "paymentMethod": "PIX",
    "qrCodeRawData": "00020126580014BR.GOV.BCB.PIX0136a3e1b2c3-d4e5-f6a7-b8c9-0d1e2f3a4b5c5204000053039865802BR5915NOME DO PAGADOR6008BRASILIA62070503***6304CA1A"
  },
  "status": "SUCCESS",
  "message": "QR Code processado com sucesso. TransaÃ§Ã£o sugerida."
}
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> --------------------------------------------------------------------------- 