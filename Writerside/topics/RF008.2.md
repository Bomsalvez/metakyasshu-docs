# RF008.2 ðŸ·ï¸ CategorizaÃ§Ã£o manual e personalizaÃ§Ã£o de categorias

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade permite ao usuÃ¡rio categorizar manualmente suas transaÃ§Ãµes e tambÃ©m criar, editar e gerenciar suas
prÃ³prias categorias personalizadas para um controle financeiro mais preciso e adaptado Ã s suas necessidades.

## ðŸ‘¥ Atores

- ðŸ‘¤ UsuÃ¡rio Autenticado

## âš ï¸ PrÃ©-condiÃ§Ãµes

- O usuÃ¡rio deve estar logado no sistema.
- Para categorizaÃ§Ã£o manual, o usuÃ¡rio deve ter transaÃ§Ãµes registradas.

## ðŸ”Œ Endpoints

- `PUT /api/transactions/{transactionId}/category` (para categorizaÃ§Ã£o manual)
- `POST /api/categories` (para criar categoria)
- `GET /api/categories` (para listar categorias)
- `PUT /api/categories/{categoryId}` (para editar categoria)
- `DELETE /api/categories/{categoryId}` (para excluir categoria)

## ðŸ“‹ Dados para CategorizaÃ§Ã£o e Categorias

| Campo            | Tipo     | ObrigatÃ³rio | DescriÃ§Ã£o                           | RestriÃ§Ãµes                                    |
|------------------|----------|-------------|-------------------------------------|-----------------------------------------------|
| `transaction_id` | `string` | âœ… Sim       | ID da transaÃ§Ã£o a ser categorizada  | UUID vÃ¡lido, transaÃ§Ã£o existente              |
| `category_id`    | `string` | âœ… Sim       | ID da categoria para atribuir       | UUID vÃ¡lido, categoria existente              |
| `name`           | `string` | âœ… Sim       | Nome da nova categoria              | MÃ­nimo de 3 caracteres, Ãºnico para o usuÃ¡rio  |
| `type`           | `string` | âœ… Sim       | Tipo da categoria (receita/despesa) | `revenue`, `expense`                          |
| `icon`           | `string` | â¬œ NÃ£o       | Ãcone da categoria                  | Nome de Ã­cone vÃ¡lido (ex: `fa-shopping-cart`) |

## ðŸ”„ Fluxo Principal - CategorizaÃ§Ã£o Manual

```mermaid
sequenceDiagram
    actor U as UsuÃ¡rio
    participant S as Sistema
    participant BD as Banco de Dados
    U->>S: Acessa lista de transaÃ§Ãµes nÃ£o categorizadas
    S->>U: Exibe transaÃ§Ãµes pendentes
    U->>S: Seleciona transaÃ§Ã£o e escolhe categoria
    S->>S: Valida categoria selecionada
    S->>BD: Atualiza transaÃ§Ã£o com nova categoria
    BD->>S: Confirma atualizaÃ§Ã£o
    S->>U: Exibe transaÃ§Ã£o categorizada na lista
```

1. O usuÃ¡rio autenticado acessa a lista de suas transaÃ§Ãµes.
2. O sistema exibe as transaÃ§Ãµes, destacando as que ainda nÃ£o foram categorizadas ou que foram marcadas para revisÃ£o
   manual.
3. O usuÃ¡rio seleciona uma transaÃ§Ã£o e escolhe uma categoria existente (padrÃ£o ou personalizada) na lista.
4. O sistema valida a categoria selecionada e atualiza a transaÃ§Ã£o com essa nova categoria no banco de dados.
5. O sistema exibe uma mensagem de sucesso e a transaÃ§Ã£o aparece como categorizada na lista.

## ðŸ”„ Fluxo Principal - GestÃ£o de Categorias Personalizadas

```mermaid
sequenceDiagram
    actor U as UsuÃ¡rio
    participant S as Sistema
    participant BD as Banco de Dados
    U->>S: Acessa seÃ§Ã£o de categorias
    S->>BD: Solicita lista de categorias do usuÃ¡rio
    BD->>S: Retorna categorias
    S->>U: Exibe lista de categorias (padrÃ£o e personalizadas)
    U->>S: Opta por Criar/Editar/Excluir categoria
    alt Criar Categoria
        U->>S: Informa nome, tipo e Ã­cone (opcional)
        S->>S: Valida dados da nova categoria
        S->>BD: Salva nova categoria
        BD->>S: Confirma salvamento
        S->>U: Exibe mensagem de sucesso e nova categoria na lista
    else Editar Categoria
        U->>S: Seleciona categoria e altera nome/Ã­cone
        S->>S: Valida dados atualizados
        S->>BD: Atualiza categoria
        BD->>S: Confirma atualizaÃ§Ã£o
        S->>U: Exibe mensagem de sucesso e categoria atualizada
    else Excluir Categoria
        U->>S: Seleciona categoria e confirma exclusÃ£o
        S->>S: Verifica transaÃ§Ãµes associadas
        S->>BD: Remove categoria (e reatribui transaÃ§Ãµes, se necessÃ¡rio)
        BD->>S: Confirma remoÃ§Ã£o
        S->>U: Exibe mensagem de sucesso e remove categoria da lista
    end
```

1. O usuÃ¡rio autenticado acessa a seÃ§Ã£o de gerenciamento de categorias.
2. O sistema exibe uma lista de todas as categorias disponÃ­veis (padrÃ£o e as criadas pelo usuÃ¡rio).
3. O usuÃ¡rio seleciona uma opÃ§Ã£o:
   a. **Criar Nova Categoria:** Preenche o nome, tipo (receita/despesa) e, opcionalmente, um Ã­cone para a nova
   categoria. O sistema valida os dados (nome Ãºnico, tipo vÃ¡lido) e salva a nova categoria no banco de dados,
   associando-a ao usuÃ¡rio.
   b. **Editar Categoria Existente:** Seleciona uma categoria da lista, modifica seu nome ou Ã­cone. O sistema valida as
   alteraÃ§Ãµes e atualiza a categoria no banco de dados.
   c. **Excluir Categoria Existente:** Seleciona uma categoria e confirma a exclusÃ£o. O sistema verifica se hÃ¡
   transaÃ§Ãµes associadas a essa categoria e pode solicitar uma reatribuiÃ§Ã£o dessas transaÃ§Ãµes antes da exclusÃ£o. A
   categoria Ã© removida do banco de dados.
4. O sistema exibe uma mensagem de sucesso apÃ³s cada operaÃ§Ã£o e atualiza a lista de categorias.

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - Categoria nÃ£o encontrada

1. Ao tentar categorizar uma transaÃ§Ã£o com uma `category_id` invÃ¡lida ou ao tentar editar/excluir uma categoria
   inexistente, o sistema exibe uma mensagem de erro indicando que a categoria nÃ£o foi encontrada.

### âš ï¸ FE02 - Dados de categoria invÃ¡lidos (para criaÃ§Ã£o/ediÃ§Ã£o)

1. Se o nome da categoria for muito curto, jÃ¡ existir para o usuÃ¡rio, ou o tipo for invÃ¡lido, o sistema exibe uma
   mensagem de erro especÃ­fica.
2. O sistema mantÃ©m o usuÃ¡rio no formulÃ¡rio para que ele corrija os dados.

### âš ï¸ FE03 - Tentativa de exclusÃ£o de categoria com transaÃ§Ãµes associadas

1. Se o usuÃ¡rio tentar excluir uma categoria que ainda possui transaÃ§Ãµes vinculadas, o sistema alerta o usuÃ¡rio e
   solicita que ele reatribua essas transaÃ§Ãµes para outra categoria antes de prosseguir com a exclusÃ£o.

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP - Categorizar TransaÃ§Ã£o Manualmente

```http
PUT /api/transactions/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678/category HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "category_id": "uuid-da-nova-categoria"
}
```

### RequisiÃ§Ã£o HTTP - Criar Nova Categoria

```http
POST /api/categories HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "name": "Transporte PÃºblico",
  "type": "expense",
  "icon": "fa-bus"
}
```

### RequisiÃ§Ã£o HTTP - Listar Categorias

```http
GET /api/categories HTTP/1.1
Host: api.metakyasshu.com
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]
```

### RequisiÃ§Ã£o HTTP - Editar Categoria

```http
PUT /api/categories/uuid-da-categoria-existente HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "name": "Transporte Urbano",
  "icon": "fa-train"
}
```

### RequisiÃ§Ã£o HTTP - Excluir Categoria

```http
DELETE /api/categories/uuid-da-categoria-a-excluir HTTP/1.1
Host: api.metakyasshu.com
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> --------------------------------------------------------------------------- 