# RF020 âœ… Sistema de aprovaÃ§Ãµes para gastos ou transaÃ§Ãµes em grupo

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade implementa um sistema de aprovaÃ§Ãµes para gastos ou transaÃ§Ãµes realizadas em grupo. Isso permite que
os membros do grupo, com permissÃ£o de aprovaÃ§Ã£o, revisem e aprovem transaÃ§Ãµes antes que elas sejam finalizadas,
garantindo maior controle e transparÃªncia nas finanÃ§as compartilhadas.

## ðŸ‘¥ Atores

- ðŸ‘¤ **UsuÃ¡rio Solicitante**: O usuÃ¡rio que inicia a transaÃ§Ã£o ou gasto que requer aprovaÃ§Ã£o.
- ðŸ‘¥ **Aprovador do Grupo**: Um membro do grupo com permissÃ£o para aprovar ou rejeitar transaÃ§Ãµes.

## âš ï¸ PrÃ©-condiÃ§Ãµes

- O usuÃ¡rio deve estar autenticado no sistema.
- A transaÃ§Ã£o ou gasto deve ter sido criada e estar pendente de aprovaÃ§Ã£o.
- O aprovador deve ser um membro do grupo e ter a permissÃ£o de `APPROVE`.

## ðŸ”Œ Endpoints

- `PUT /api/groups/{groupId}/transactions/{transactionId}/approve`
- `PUT /api/groups/{groupId}/transactions/{transactionId}/reject`

## ðŸ“‹ Dados de AprovaÃ§Ã£o/RejeiÃ§Ã£o de TransaÃ§Ã£o

| Campo           | Tipo     | ObrigatÃ³rio | DescriÃ§Ã£o                                       | RestriÃ§Ãµes                                               |
|-----------------|----------|-------------|-------------------------------------------------|----------------------------------------------------------|
| `groupId`       | `string` | âœ… Sim       | ID Ãºnico do grupo financeiro.                   | Deve ser um ID de grupo vÃ¡lido e existente.              |
| `transactionId` | `string` | âœ… Sim       | ID Ãºnico da transaÃ§Ã£o a ser aprovada/rejeitada. | Deve ser um ID de transaÃ§Ã£o vÃ¡lido e existente no grupo. |
| `reason`        | `string` | âŒ NÃ£o       | Motivo da rejeiÃ§Ã£o (opcional).                  | Texto livre, mÃ¡ximo 255 caracteres.                      |

## ðŸ”„ Fluxo Principal - AprovaÃ§Ã£o de TransaÃ§Ã£o

```mermaid
sequenceDiagram
    actor A as Aprovador do Grupo
    participant S as Sistema
    A ->> S: 1. Seleciona uma transaÃ§Ã£o pendente e solicita aprovaÃ§Ã£o (PUT /api/groups/{groupId}/transactions/{transactionId}/approve)
    S ->> S: 2. Valida o aprovador e a transaÃ§Ã£o
    S ->> S: 3. Atualiza o status da transaÃ§Ã£o para "Aprovada" no banco de dados
    S ->> S: 4. Notifica o usuÃ¡rio solicitante da aprovaÃ§Ã£o
    S ->> A: 5. Retorna confirmaÃ§Ã£o de sucesso (HTTP 200 OK)
```

1. O Aprovador do Grupo envia uma requisiÃ§Ã£o PUT para `/api/groups/{groupId}/transactions/{transactionId}/approve`.
2. O sistema valida se o usuÃ¡rio que fez a requisiÃ§Ã£o tem a permissÃ£o de `APPROVE` para o `groupId` e se a
   `transactionId` estÃ¡ pendente de aprovaÃ§Ã£o no grupo.
3. O sistema atualiza o status da transaÃ§Ã£o para "Aprovada" no banco de dados.
4. O sistema pode enviar uma notificaÃ§Ã£o ao usuÃ¡rio que solicitou a transaÃ§Ã£o informando sobre a aprovaÃ§Ã£o.
5. O sistema retorna uma resposta HTTP 200 OK com uma mensagem de sucesso.

## ðŸ”„ Fluxo Principal - RejeiÃ§Ã£o de TransaÃ§Ã£o

```mermaid
sequenceDiagram
    actor A as Aprovador do Grupo
    participant S as Sistema
    A ->> S: 1. Seleciona uma transaÃ§Ã£o pendente e solicita rejeiÃ§Ã£o (PUT /api/groups/{groupId}/transactions/{transactionId}/reject)
    S ->> S: 2. Valida o aprovador e a transaÃ§Ã£o
    S ->> S: 3. Atualiza o status da transaÃ§Ã£o para "Rejeitada" no banco de dados, incluindo o motivo
    S ->> S: 4. Notifica o usuÃ¡rio solicitante da rejeiÃ§Ã£o
    S ->> A: 5. Retorna confirmaÃ§Ã£o de sucesso (HTTP 200 OK)
```

1. O Aprovador do Grupo envia uma requisiÃ§Ã£o PUT para `/api/groups/{groupId}/transactions/{transactionId}/reject`,
   podendo incluir um `reason`.
2. O sistema valida se o usuÃ¡rio que fez a requisiÃ§Ã£o tem a permissÃ£o de `APPROVE` para o `groupId` e se a
   `transactionId` estÃ¡ pendente de aprovaÃ§Ã£o no grupo.
3. O sistema atualiza o status da transaÃ§Ã£o para "Rejeitada" no banco de dados e registra o motivo da rejeiÃ§Ã£o, se
   fornecido.
4. O sistema pode enviar uma notificaÃ§Ã£o ao usuÃ¡rio que solicitou a transaÃ§Ã£o informando sobre a rejeiÃ§Ã£o e o motivo.
5. O sistema retorna uma resposta HTTP 200 OK com uma mensagem de sucesso.

## ðŸ”€ Fluxos Alternativos

### âš ï¸ FA01 - MÃºltiplas AprovaÃ§Ãµes NecessÃ¡rias

1. Se a configuraÃ§Ã£o do grupo exigir mÃºltiplas aprovaÃ§Ãµes, a transaÃ§Ã£o permanece "Pendente" atÃ© que o nÃºmero necessÃ¡rio
   de aprovadores a aprove.
2. O sistema registra cada aprovaÃ§Ã£o individual e sÃ³ altera o status final da transaÃ§Ã£o apÃ³s todas as aprovaÃ§Ãµes
   necessÃ¡rias.

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - TransaÃ§Ã£o NÃ£o Encontrada ou NÃ£o Pertencente ao Grupo

1. O `transactionId` especificado nÃ£o Ã© encontrado ou nÃ£o pertence ao `groupId`.
2. O sistema retorna uma resposta HTTP 404 Not Found.

### âš ï¸ FE02 - UsuÃ¡rio NÃ£o Autorizado

1. O usuÃ¡rio que tenta aprovar/rejeitar a transaÃ§Ã£o nÃ£o tem a permissÃ£o de `APPROVE` para o grupo ou nÃ£o Ã© membro do
   grupo.
2. O sistema retorna uma resposta HTTP 403 Forbidden.

### âš ï¸ FE03 - TransaÃ§Ã£o JÃ¡ Aprovada/Rejeitada

1. O usuÃ¡rio tenta aprovar ou rejeitar uma transaÃ§Ã£o que jÃ¡ foi finalizada (aprovada ou rejeitada).
2. O sistema retorna uma resposta HTTP 409 Conflict.

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP para Aprovar TransaÃ§Ã£o

```http
PUT /api/groups/grp_123abc/transactions/trn_xyz456/approve HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json

{}
```

### RequisiÃ§Ã£o HTTP para Rejeitar TransaÃ§Ã£o com Motivo

```http
PUT /api/groups/grp_123abc/transactions/trn_xyz456/reject HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json

{
  "reason": "OrÃ§amento excedido para este tipo de gasto."
}
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> --------------------------------------------------------------------------- 