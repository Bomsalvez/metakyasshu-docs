# RF024 ðŸ“… CalendÃ¡rio financeiro compartilhado

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade permite um calendÃ¡rio financeiro compartilhado com eventos e vencimentos importantes. Os usuÃ¡rios
podem adicionar e visualizar datas de pagamentos, recebimentos, faturas, metas e outros eventos financeiros relevantes
para o grupo, garantindo que todos os membros estejam cientes dos compromissos financeiros.

## ðŸ‘¥ Atores

- ðŸ‘¤ **Membro do Grupo**: Qualquer usuÃ¡rio que faz parte de um grupo financeiro.

## âš ï¸ PrÃ©-condiÃ§Ãµes

- O usuÃ¡rio deve estar autenticado no sistema.
- O usuÃ¡rio deve ser membro de um grupo financeiro existente.

## ðŸ”Œ Endpoints

- `POST /api/groups/{groupId}/calendar/events` (Criar Evento de CalendÃ¡rio)
- `GET /api/groups/{groupId}/calendar/events` (Listar Eventos de CalendÃ¡rio do Grupo)
- `PUT /api/groups/{groupId}/calendar/events/{eventId}` (Atualizar Evento de CalendÃ¡rio)
- `DELETE /api/groups/{groupId}/calendar/events/{eventId}` (Excluir Evento de CalendÃ¡rio)

## ðŸ“‹ Dados de Evento de CalendÃ¡rio

| Campo               | Tipo                | ObrigatÃ³rio | DescriÃ§Ã£o                                            | RestriÃ§Ãµes                                                             |
|---------------------|---------------------|-------------|------------------------------------------------------|------------------------------------------------------------------------|
| `groupId`           | `string`            | âœ… Sim       | ID Ãºnico do grupo financeiro.                        | Deve ser um ID de grupo vÃ¡lido e existente.                            |
| `title`             | `string`            | âœ… Sim       | TÃ­tulo do evento (ex: "Pagamento Aluguel").          | MÃ¡ximo 100 caracteres.                                                 |
| `description`       | `string`            | âŒ NÃ£o       | DescriÃ§Ã£o detalhada do evento.                       | MÃ¡ximo 500 caracteres.                                                 |
| `type`              | `string`            | âœ… Sim       | Tipo do evento financeiro.                           | Valores permitidos: `BILL`, `RECEIVABLE`, `GOAL`, `REMINDER`, `OTHER`. |
| `amount`            | `number`            | âŒ NÃ£o       | Valor associado ao evento (se aplicÃ¡vel).            | Deve ser um nÃºmero positivo.                                           |
| `currency`          | `string`            | Condicional | Moeda do valor (se `amount` for fornecido).          | Ex: `BRL`, `USD`.                                                      |
| `dueDate`           | `string` (ISO 8601) | âœ… Sim       | Data do evento/vencimento.                           | Formato `YYYY-MM-DD`.                                                  |
| `isRecurrent`       | `boolean`           | âœ… Sim       | Indica se o evento se repete.                        | PadrÃ£o: `false`.                                                       |
| `recurrencePattern` | `string`            | Condicional | PadrÃ£o de recorrÃªncia (se `isRecurrent` for `true`). | Ex: `DAILY`, `WEEKLY`, `MONTHLY`, `YEARLY`.                            |
| `notifiedMembers`   | `array`             | âŒ NÃ£o       | Lista de IDs de membros a serem notificados.         | Se vazio, todos os membros do grupo sÃ£o notificados.                   |

## ðŸ”„ Fluxo Principal - CriaÃ§Ã£o de Evento

```mermaid
sequenceDiagram
    actor M as Membro do Grupo
    participant S as Sistema
    M ->> S: 1. Adiciona um novo evento ao calendÃ¡rio do grupo (POST /api/groups/{groupId}/calendar/events)
    S ->> S: 2. Valida os dados do evento e as permissÃµes do membro
    S ->> S: 3. Cria o evento no banco de dados, associado ao grupo
    S ->> S: 4. (Opcional) Envia notificaÃ§Ãµes aos membros
    S ->> M: 5. Retorna detalhes do evento criado (HTTP 201 Created)
```

1. O Membro do Grupo envia uma requisiÃ§Ã£o POST para `/api/groups/{groupId}/calendar/events` com os detalhes do novo
   evento.
2. O sistema valida os campos obrigatÃ³rios (`title`, `type`, `dueDate`, `isRecurrent`) e verifica se o `groupId` Ã©
   vÃ¡lido e se o membro tem permissÃ£o para adicionar eventos.
3. O sistema cria um novo registro de evento no banco de dados, associando-o ao `groupId`.
4. Se `notifiedMembers` for especificado, o sistema envia notificaÃ§Ãµes aos membros listados. Caso contrÃ¡rio, ou se a
   funcionalidade de notificaÃ§Ã£o estiver habilitada por padrÃ£o, notifica todos os membros do grupo sobre o novo evento.
5. O sistema retorna uma resposta HTTP 201 Created com os detalhes do evento recÃ©m-criado, incluindo seu `eventId`.

## ðŸ”„ Fluxo Principal - VisualizaÃ§Ã£o de Eventos

```mermaid
sequenceDiagram
    actor M as Membro do Grupo
    participant S as Sistema
    M ->> S: 1. Solicita visualizar eventos do calendÃ¡rio (GET /api/groups/{groupId}/calendar/events)
    S ->> S: 2. Consulta eventos associados ao groupId
    S ->> M: 3. Retorna lista de eventos (HTTP 200 OK)
```

1. O Membro do Grupo envia uma requisiÃ§Ã£o GET para `/api/groups/{groupId}/calendar/events`.
2. O sistema consulta o banco de dados por todos os eventos de calendÃ¡rio associados ao `groupId`.
3. O sistema retorna uma resposta HTTP 200 OK contendo uma lista de objetos de evento, cada um com seus detalhes
   completos.

## ðŸ”€ Fluxos Alternativos

### âš ï¸ FA01 - Filtragem por Data ou Tipo

1. O usuÃ¡rio pode adicionar parÃ¢metros de query Ã  requisiÃ§Ã£o GET (e.g.,
   `?startDate=2024-07-01&endDate=2024-07-31&type=BILL`) para filtrar eventos.
2. O sistema retorna apenas os eventos que correspondem aos critÃ©rios de filtragem.

### âš ï¸ FA02 - Eventos Recorrentes

1. Se `isRecurrent` for `true`, o sistema gera mÃºltiplas instÃ¢ncias do evento no calendÃ¡rio com base no
   `recurrencePattern`.
2. A ediÃ§Ã£o ou exclusÃ£o de um evento recorrente pode perguntar se a alteraÃ§Ã£o se aplica a uma Ãºnica instÃ¢ncia ou a todas
   as futuras instÃ¢ncias.

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - Grupo NÃ£o Encontrado

1. O `groupId` especificado nÃ£o Ã© encontrado.
2. O sistema retorna uma resposta HTTP 404 Not Found.

### âš ï¸ FE02 - UsuÃ¡rio NÃ£o Autorizado

1. O usuÃ¡rio que tenta criar, atualizar ou excluir um evento nÃ£o Ã© membro do `groupId`.
2. O sistema retorna uma resposta HTTP 403 Forbidden.

### âš ï¸ FE03 - Dados InvÃ¡lidos

1. Campos obrigatÃ³rios estÃ£o faltando ou contÃªm valores invÃ¡lidos (e.g., `dueDate` mal formatado, `type` nÃ£o
   reconhecido).
2. O sistema retorna uma resposta HTTP 400 Bad Request.

### âš ï¸ FE04 - Evento NÃ£o Encontrado (para atualizaÃ§Ã£o/exclusÃ£o)

1. O `eventId` especificado para atualizaÃ§Ã£o ou exclusÃ£o nÃ£o Ã© encontrado dentro do `groupId`.
2. O sistema retorna uma resposta HTTP 404 Not Found.

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP para Criar um Evento de Pagamento Recorrente Mensal

```http
POST /api/groups/grp_abc456/calendar/events HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json

{
  "title": "Pagamento Mensal da Internet",
  "description": "Fatura mensal da internet para o apartamento do grupo.",
  "type": "BILL",
  "amount": 120.00,
  "currency": "BRL",
  "dueDate": "2024-08-10",
  "isRecurrent": true,
  "recurrencePattern": "MONTHLY"
}
```

### RequisiÃ§Ã£o HTTP para Listar Eventos de Agosto de 2024

```http
GET /api/groups/grp_abc456/calendar/events?startDate=2024-08-01&endDate=2024-08-31 HTTP/1.1
Host: api.metakyasshu.com
```

### RequisiÃ§Ã£o HTTP para Excluir um Evento

```http
DELETE /api/groups/grp_abc456/calendar/events/evt_xyz789 HTTP/1.1
Host: api.metakyasshu.com
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> --------------------------------------------------------------------------- 