# RF006.4 ðŸ’³ GestÃ£o de cartÃµes de crÃ©dito/dÃ©bito

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade permite que o usuÃ¡rio gerencie (visualize, edite e exclua) seus cartÃµes de crÃ©dito e dÃ©bito
cadastrados no sistema.

## ðŸ‘¥ Atores

- ðŸ‘¤ UsuÃ¡rio Autenticado

## âš ï¸ PrÃ©-condiÃ§Ãµes

- O usuÃ¡rio deve estar logado no sistema.
- O usuÃ¡rio deve ter pelo menos um cartÃ£o cadastrado.

## ðŸ”Œ Endpoints

- `GET /api/card`
- `GET /api/card/{cardId}`
- `PUT /api/card/{cardId}`
- `DELETE /api/card/{cardId}`

## ðŸ“‹ Dados do CartÃ£o

| Campo             | Tipo     | ObrigatÃ³rio | DescriÃ§Ã£o                               | RestriÃ§Ãµes                   |
|-------------------|----------|-------------|-----------------------------------------|------------------------------|
| `cardId`          | `string` | âœ… Sim       | ID Ãºnico do cartÃ£o                      | UUID vÃ¡lido                  |
| `cardholder_name` | `string` | â¬œ NÃ£o       | Nome do titular do cartÃ£o (para ediÃ§Ã£o) | MÃ­nimo de 3 caracteres       |
| `expiry_date`     | `string` | â¬œ NÃ£o       | Data de validade (MM/AA) (para ediÃ§Ã£o)  | Formato MM/AA vÃ¡lido, futuro |
| `card_type`       | `string` | â¬œ NÃ£o       | Tipo de cartÃ£o (para ediÃ§Ã£o)            | `credit`, `debit`            |
| `flag`            | `string` | â¬œ NÃ£o       | Bandeira do cartÃ£o (para ediÃ§Ã£o)        | Texto livre                  |

## ðŸ”„ Fluxo Principal

```mermaid
sequenceDiagram
    actor U as UsuÃ¡rio
    participant S as Sistema
    participant BD as Banco de Dados
    U->>S: Acessa a seÃ§Ã£o de gerenciamento de cartÃµes
    S->>BD: Solicita lista de cartÃµes do usuÃ¡rio
    BD->>S: Retorna lista de cartÃµes
    S->>U: Exibe a lista de cartÃµes
    U->>S: Seleciona um cartÃ£o para visualizar/editar/excluir
    alt Visualizar CartÃ£o
        S->>BD: Solicita detalhes do cartÃ£o
        BD->>S: Retorna detalhes do cartÃ£o
        S->>U: Exibe detalhes do cartÃ£o selecionado
    else Editar CartÃ£o
        S->>U: Exibe formulÃ¡rio de ediÃ§Ã£o com dados atuais
        U->>S: Altera os dados e envia o formulÃ¡rio
        S->>S: Valida os dados atualizados
        S->>BD: Atualiza o cartÃ£o no banco de dados
        BD->>S: Confirma a atualizaÃ§Ã£o
        S->>U: Exibe mensagem de sucesso e cartÃ£o atualizado
    else Excluir CartÃ£o
        S->>U: Solicita confirmaÃ§Ã£o de exclusÃ£o
        U->>S: Confirma a exclusÃ£o
        S->>BD: Remove o cartÃ£o do banco de dados
        BD->>S: Confirma a remoÃ§Ã£o
        S->>U: Exibe mensagem de sucesso e remove cartÃ£o da lista
    end
```

1. O usuÃ¡rio autenticado acessa a seÃ§Ã£o de gerenciamento de cartÃµes.
2. O sistema exibe uma lista de todos os cartÃµes associados ao usuÃ¡rio.
3. O usuÃ¡rio seleciona uma opÃ§Ã£o: visualizar detalhes, editar ou excluir um cartÃ£o existente.
4. **Para VisualizaÃ§Ã£o:** O sistema exibe os detalhes completos do cartÃ£o selecionado (exceto informaÃ§Ãµes sensÃ­veis como
   nÃºmero completo e CVC).
5. **Para EdiÃ§Ã£o:**
   a. O sistema apresenta um formulÃ¡rio prÃ©-preenchido com os dados atuais do cartÃ£o (nome do titular, data de validade,
   tipo, bandeira).
   b. O usuÃ¡rio modifica os campos desejados e submete as alteraÃ§Ãµes.
   c. O sistema valida os novos dados e atualiza o cartÃ£o no banco de dados.
   d. O sistema exibe uma mensagem de sucesso e a lista de cartÃµes atualizada.
6. **Para ExclusÃ£o:**
   a. O sistema solicita uma confirmaÃ§Ã£o do usuÃ¡rio para a exclusÃ£o do cartÃ£o.
   b. ApÃ³s a confirmaÃ§Ã£o, o sistema remove o cartÃ£o do banco de dados.
   c. O sistema exibe uma mensagem de sucesso e a lista de cartÃµes atualizada (sem o cartÃ£o excluÃ­do).

## ðŸ”€ Fluxos Alternativos

### âš ï¸ FA01 - Tentativa de exclusÃ£o do Ãºltimo cartÃ£o

1. No passo 6b do fluxo principal, se o usuÃ¡rio tentar excluir o Ãºltimo cartÃ£o restante, o sistema exibe uma mensagem de
   erro informando que nÃ£o Ã© possÃ­vel excluir o Ãºnico cartÃ£o existente.

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - CartÃ£o nÃ£o encontrado

1. Em qualquer operaÃ§Ã£o (visualizar, editar, excluir), se o `cardId` fornecido nÃ£o corresponder a um cartÃ£o existente
   para o usuÃ¡rio, o sistema exibe uma mensagem de erro indicando que o cartÃ£o nÃ£o foi encontrado.

### âš ï¸ FE02 - Dados de ediÃ§Ã£o invÃ¡lidos

1. No passo 5c do fluxo principal, se os dados de ediÃ§Ã£o forem invÃ¡lidos (ex: data de validade expirada, nome muito
   curto), o sistema exibe uma mensagem de erro especÃ­fica para o campo invÃ¡lido.
2. O sistema mantÃ©m o usuÃ¡rio no formulÃ¡rio de ediÃ§Ã£o para que ele possa corrigir os dados.

### âš ï¸ FE03 - Erro ao atualizar/excluir cartÃ£o

1. No passo 5c ou 6b do fluxo principal, se ocorrer um erro interno no sistema ao tentar atualizar ou excluir o cartÃ£o,
   o sistema exibe uma mensagem de erro genÃ©rica e sugere que o usuÃ¡rio tente novamente mais tarde.

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP - Listar CartÃµes

```http
GET /api/card HTTP/1.1
Host: api.metakyasshu.com
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]
```

### RequisiÃ§Ã£o HTTP - Obter Detalhes de um CartÃ£o

```http
GET /api/card/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678 HTTP/1.1
Host: api.metakyasshu.com
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]
```

### RequisiÃ§Ã£o HTTP - Atualizar um CartÃ£o

```http
PUT /api/card/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678 HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "cardholder_name": "NOVO NOME DO TITULAR",
  "expiry_date": "12/28"
}
```

### RequisiÃ§Ã£o HTTP - Excluir um CartÃ£o

```http
DELETE /api/card/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678 HTTP/1.1
Host: api.metakyasshu.com
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> --------------------------------------------------------------------------- 