# RF022.2 ðŸŽ CriaÃ§Ã£o e gestÃ£o de arrecadaÃ§Ãµes em grupo

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade permite a criaÃ§Ã£o e gestÃ£o de arrecadaÃ§Ãµes em grupo, que sÃ£o semelhantes a vaquinhas, mas focadas na
coleta de fundos de forma mais estruturada, como para mensalidades, fundos de caixa, ou projetos especÃ­ficos do grupo.
Inclui o registro de contribuiÃ§Ãµes, acompanhamento do status de cada membro e relatÃ³rios de arrecadaÃ§Ã£o.

## ðŸ‘¥ Atores

- ðŸ‘¤ **Organizador da ArrecadaÃ§Ã£o**: O usuÃ¡rio (geralmente um administrador de grupo) que cria e gerencia a arrecadaÃ§Ã£o.
- ðŸ‘¥ **Membro do Grupo**: O usuÃ¡rio que deve contribuir para a arrecadaÃ§Ã£o.

## âš ï¸ PrÃ©-condiÃ§Ãµes

- O usuÃ¡rio (Organizador ou Membro) deve estar autenticado no sistema.
- Para criar, o Organizador deve ter permissÃ£o de administrador no grupo.
- Para contribuir, a arrecadaÃ§Ã£o deve existir e estar ativa no grupo.

## ðŸ”Œ Endpoints

- `POST /api/groups/{groupId}/collections` (Criar ArrecadaÃ§Ã£o)
- `GET /api/groups/{groupId}/collections/{collectionId}` (Obter Detalhes da ArrecadaÃ§Ã£o)
- `PUT /api/groups/{groupId}/collections/{collectionId}` (Atualizar ArrecadaÃ§Ã£o)
- `POST /api/groups/{groupId}/collections/{collectionId}/contributions` (Registrar ContribuiÃ§Ã£o)

## ðŸ“‹ Dados de ArrecadaÃ§Ã£o em Grupo

### CriaÃ§Ã£o/AtualizaÃ§Ã£o de ArrecadaÃ§Ã£o

| Campo                       | Tipo                | ObrigatÃ³rio | DescriÃ§Ã£o                                                                                | RestriÃ§Ãµes                                             |
|-----------------------------|---------------------|-------------|------------------------------------------------------------------------------------------|--------------------------------------------------------|
| `groupId`                   | `string`            | âœ… Sim       | ID Ãºnico do grupo financeiro.                                                            | Deve ser um ID de grupo vÃ¡lido e existente.            |
| `name`                      | `string`            | âœ… Sim       | Nome da arrecadaÃ§Ã£o (ex: "Caixinha de Viagem").                                          | MÃ¡ximo 100 caracteres.                                 |
| `description`               | `string`            | âŒ NÃ£o       | DescriÃ§Ã£o detalhada da arrecadaÃ§Ã£o.                                                      | MÃ¡ximo 500 caracteres.                                 |
| `targetAmount`              | `number`            | âœ… Sim       | Valor total a ser arrecadado (opcional, se a meta for por contribuiÃ§Ã£o individual fixa). | Deve ser um nÃºmero positivo.                           |
| `currency`                  | `string`            | âœ… Sim       | Moeda da arrecadaÃ§Ã£o.                                                                    | Ex: `BRL`, `USD`.                                      |
| `dueDate`                   | `string` (ISO 8601) | âŒ NÃ£o       | Data limite para arrecadaÃ§Ã£o.                                                            | Formato `YYYY-MM-DD`.                                  |
| `membersContributionAmount` | `number`            | âŒ NÃ£o       | Valor de contribuiÃ§Ã£o individual esperada por membro (se aplicÃ¡vel).                     | Deve ser um nÃºmero positivo.                           |
| `status`                    | `string`            | âœ… Sim       | Status da arrecadaÃ§Ã£o.                                                                   | Valores permitidos: `ACTIVE`, `COMPLETED`, `CANCELED`. |

### Registro de ContribuiÃ§Ã£o

| Campo              | Tipo                | ObrigatÃ³rio | DescriÃ§Ã£o                                    | RestriÃ§Ãµes                                                 |
|--------------------|---------------------|-------------|----------------------------------------------|------------------------------------------------------------|
| `collectionId`     | `string`            | âœ… Sim       | ID Ãºnico da arrecadaÃ§Ã£o.                     | Deve ser um ID de arrecadaÃ§Ã£o vÃ¡lido e existente no grupo. |
| `contributorId`    | `string`            | âœ… Sim       | ID do membro do grupo que estÃ¡ contribuindo. | Deve ser um ID de usuÃ¡rio vÃ¡lido e membro do grupo.        |
| `amount`           | `number`            | âœ… Sim       | Valor da contribuiÃ§Ã£o.                       | Deve ser um nÃºmero positivo.                               |
| `contributionDate` | `string` (ISO 8601) | âœ… Sim       | Data da contribuiÃ§Ã£o.                        | Formato `YYYY-MM-DD`.                                      |
| `notes`            | `string`            | âŒ NÃ£o       | ObservaÃ§Ãµes sobre a contribuiÃ§Ã£o.            | MÃ¡ximo 255 caracteres.                                     |

## ðŸ”„ Fluxo Principal - CriaÃ§Ã£o de ArrecadaÃ§Ã£o

```mermaid
sequenceDiagram
    actor O as Organizador da ArrecadaÃ§Ã£o
    participant S as Sistema
    O ->> S: 1. Preenche formulÃ¡rio de criaÃ§Ã£o de arrecadaÃ§Ã£o (POST /api/groups/{groupId}/collections)
    S ->> S: 2. Valida dados da arrecadaÃ§Ã£o e permissÃµes do Organizador
    S ->> S: 3. Cria a arrecadaÃ§Ã£o no banco de dados, associada ao grupo
    S ->> O: 4. Retorna detalhes da arrecadaÃ§Ã£o criada (HTTP 201 Created)
```

1. O Organizador da ArrecadaÃ§Ã£o envia uma requisiÃ§Ã£o POST para `/api/groups/{groupId}/collections` com os detalhes da
   nova arrecadaÃ§Ã£o.
2. O sistema valida os dados e verifica se o Organizador tem permissÃ£o para criar arrecadaÃ§Ãµes no `groupId`.
3. O sistema cria um novo registro de arrecadaÃ§Ã£o no banco de dados, associando-o ao `groupId` e ao Organizador.
4. O sistema retorna uma resposta HTTP 201 Created com os detalhes da arrecadaÃ§Ã£o recÃ©m-criada, incluindo seu
   `collectionId`.

## ðŸ”„ Fluxo Principal - Registro de ContribuiÃ§Ã£o

```mermaid
sequenceDiagram
    actor M as Membro do Grupo
    participant S as Sistema
    M ->> S: 1. Informa valor e solicita registro de contribuiÃ§Ã£o (POST /api/groups/{groupId}/collections/{collectionId}/contributions)
    S ->> S: 2. Valida a arrecadaÃ§Ã£o, o membro e o valor
    S ->> S: 3. Registra a contribuiÃ§Ã£o e atualiza o `currentAmount` e status do membro na arrecadaÃ§Ã£o
    S ->> M: 4. Retorna confirmaÃ§Ã£o de sucesso (HTTP 200 OK)
```

1. O Membro do Grupo envia uma requisiÃ§Ã£o POST para `/api/groups/{groupId}/collections/{collectionId}/contributions` com
   o `amount` da contribuiÃ§Ã£o.
2. O sistema valida se a `collectionId` existe no `groupId` e estÃ¡ ativa, se o `contributorId` Ã© um membro do grupo, e
   se o `amount` Ã© vÃ¡lido.
3. O sistema registra a contribuiÃ§Ã£o no banco de dados e atualiza o valor total arrecadado (`currentAmount`) e o status
   de contribuiÃ§Ã£o do `contributorId` para aquela arrecadaÃ§Ã£o.
4. O sistema retorna uma resposta HTTP 200 OK com uma mensagem de sucesso.

## ðŸ”€ Fluxos Alternativos

### âš ï¸ FA01 - Acompanhamento Individual

1. Cada membro do grupo pode visualizar seu histÃ³rico de contribuiÃ§Ãµes para cada arrecadaÃ§Ã£o.
2. O sistema exibe um resumo do quanto cada membro jÃ¡ contribuiu e quanto ainda falta, se houver um
   `membersContributionAmount` definido.

### âš ï¸ FA02 - ArrecadaÃ§Ã£o por Valor Alvo

1. Se `targetAmount` for definido, a arrecadaÃ§Ã£o pode ser marcada como `COMPLETED` automaticamente ao atingir o valor.
2. O sistema notifica o Organizador quando o objetivo Ã© alcanÃ§ado.

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - ArrecadaÃ§Ã£o NÃ£o Encontrada ou NÃ£o Pertencente ao Grupo

1. A `collectionId` especificada nÃ£o Ã© encontrada ou nÃ£o pertence ao `groupId`.
2. O sistema retorna uma resposta HTTP 404 Not Found.

### âš ï¸ FE02 - UsuÃ¡rio NÃ£o Autorizado (para criaÃ§Ã£o/atualizaÃ§Ã£o)

1. O usuÃ¡rio que tenta criar ou atualizar a arrecadaÃ§Ã£o nÃ£o tem as permissÃµes de administrador para o grupo.
2. O sistema retorna uma resposta HTTP 403 Forbidden.

### âš ï¸ FE03 - ContribuiÃ§Ã£o InvÃ¡lida

1. O `amount` fornecido para a contribuiÃ§Ã£o Ã© negativo, zero ou excede algum limite (se houver).
2. O sistema retorna uma resposta HTTP 400 Bad Request.

### âš ï¸ FE04 - ArrecadaÃ§Ã£o Inativa

1. O usuÃ¡rio tenta contribuir para uma arrecadaÃ§Ã£o que estÃ¡ `COMPLETED` ou `CANCELED`.
2. O sistema retorna uma resposta HTTP 403 Forbidden.

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP para Criar uma ArrecadaÃ§Ã£o de Caixa de Fundo

```http
POST /api/groups/grp_abc456/collections HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json

{
  "name": "Fundo de Caixa - Eventos Sociais",
  "description": "ArrecadaÃ§Ã£o para despesas com eventos sociais do grupo.",
  "currency": "BRL",
  "membersContributionAmount": 20.00,
  "status": "ACTIVE"
}
```

### RequisiÃ§Ã£o HTTP para Registrar uma ContribuiÃ§Ã£o

```http
POST /api/groups/grp_abc456/collections/col_xyz789/contributions HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json

{
  "contributorId": "usr_111",
  "amount": 20.00,
  "contributionDate": "2024-07-20",
  "notes": "Mensalidade de Julho"
}
```

### RequisiÃ§Ã£o HTTP para Obter Detalhes da ArrecadaÃ§Ã£o

```http
GET /api/groups/grp_abc456/collections/col_xyz789 HTTP/1.1
Host: api.metakyasshu.com
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> --------------------------------------------------------------------------- 