# RF014 ðŸ’µ ClassificaÃ§Ã£o da forma de pagamento

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade permite a classificaÃ§Ã£o detalhada da forma de pagamento utilizada em transaÃ§Ãµes (ex: Pix, Boleto,
CartÃ£o de CrÃ©dito, DÃ©bito, Cheque, CarnÃª, Dinheiro, TransferÃªncia bancÃ¡ria), bem como a gestÃ£o dessas formas de
pagamento para um registro financeiro mais preciso.

## ðŸ‘¥ Atores

- ðŸ‘¤ UsuÃ¡rio Autenticado

## âš ï¸ PrÃ©-condiÃ§Ãµes

- O usuÃ¡rio deve estar logado no sistema.
- O usuÃ¡rio deve ter transaÃ§Ãµes registradas para classificÃ¡-las.
- O usuÃ¡rio deve ter contas bancÃ¡rias ou cartÃµes cadastrados se a forma de pagamento for vinculada a eles.

## ðŸ”Œ Endpoints

- `POST /api/payment-methods` (Criar forma de pagamento)
- `GET /api/payment-methods` (Listar formas de pagamento)
- `GET /api/payment-methods/{paymentMethodId}` (Obter detalhes de forma de pagamento)
- `PUT /api/payment-methods/{paymentMethodId}` (Atualizar forma de pagamento)
- `DELETE /api/payment-methods/{paymentMethodId}` (Excluir forma de pagamento)
- `PUT /api/transactions/{transactionId}/payment-method` (Classificar forma de pagamento em transaÃ§Ã£o existente)

## ðŸ“‹ Dados para ClassificaÃ§Ã£o e Formas de Pagamento

| Campo               | Tipo     | ObrigatÃ³rio                | DescriÃ§Ã£o                                                                    | RestriÃ§Ãµes                                                                     |
|---------------------|----------|----------------------------|------------------------------------------------------------------------------|--------------------------------------------------------------------------------|
| `name`              | `string` | âœ… Sim                      | Nome da forma de pagamento (ex: "CartÃ£o de CrÃ©dito Visa", "Dinheiro", "Pix") | MÃ­nimo de 2 caracteres, Ãºnico para o usuÃ¡rio                                   |
| `type`              | `string` | âœ… Sim                      | Tipo genÃ©rico da forma de pagamento                                          | `credit_card`, `debit_card`, `cash`, `bank_transfer`, `pix`, `boleto`, `other` |
| `description`       | `string` | â¬œ NÃ£o                      | DescriÃ§Ã£o adicional da forma de pagamento                                    | MÃ¡ximo de 255 caracteres                                                       |
| `account_id`        | `string` | â¬œ NÃ£o                      | ID da conta bancÃ¡ria/cartÃ£o associada (se aplicÃ¡vel)                         | UUID vÃ¡lido, conta/cartÃ£o existente                                            |
| `transaction_id`    | `string` | âœ… Sim (para classificaÃ§Ã£o) | ID da transaÃ§Ã£o a ser classificada                                           | UUID vÃ¡lido, transaÃ§Ã£o existente                                               |
| `payment_method_id` | `string` | âœ… Sim (para classificaÃ§Ã£o) | ID da forma de pagamento a atribuir                                          | UUID vÃ¡lido, forma de pagamento existente                                      |

## ðŸ”„ Fluxo Principal - ClassificaÃ§Ã£o de Forma de Pagamento em TransaÃ§Ã£o

```mermaid
sequenceDiagram
    actor U as UsuÃ¡rio
    participant S as Sistema
    participant BD as Banco de Dados
    U->>S: Acessa lista de transaÃ§Ãµes
    S->>U: Exibe transaÃ§Ãµes
    U->>S: Seleciona transaÃ§Ã£o e escolhe forma de pagamento
    S->>S: Valida forma de pagamento
    S->>BD: Atualiza transaÃ§Ã£o com nova forma de pagamento
    BD->>S: Confirma atualizaÃ§Ã£o
    S->>U: Exibe transaÃ§Ã£o atualizada
```

1. O usuÃ¡rio autenticado acessa a lista de suas transaÃ§Ãµes.
2. O sistema exibe as transaÃ§Ãµes.
3. O usuÃ¡rio seleciona uma transaÃ§Ã£o e escolhe uma forma de pagamento existente (cadastrada previamente) na lista.
4. O sistema valida a forma de pagamento selecionada e associa-a Ã  transaÃ§Ã£o no banco de dados.
5. O sistema exibe uma mensagem de sucesso e a transaÃ§Ã£o Ã© atualizada com a forma de pagamento.

## ðŸ”„ Fluxo Principal - GestÃ£o de Formas de Pagamento

```mermaid
sequenceDiagram
    actor U as UsuÃ¡rio
    participant S as Sistema
    participant BD as Banco de Dados
    U->>S: Acessa a seÃ§Ã£o de Formas de Pagamento
    S->>BD: Solicita lista de formas de pagamento do usuÃ¡rio
    BD->>S: Retorna lista de formas de pagamento
    S->>U: Exibe a lista de formas de pagamento
    U->>S: Opta por Criar/Editar/Excluir forma de pagamento
    alt Criar Forma de Pagamento
        U->>S: Informa nome, tipo, descriÃ§Ã£o (opcional) e conta associada (opcional)
        S->>S: Valida dados da nova forma de pagamento
        S->>BD: Salva nova forma de pagamento
        BD->>S: Confirma salvamento
        S->>U: Exibe mensagem de sucesso e nova forma de pagamento na lista
    else Editar Forma de Pagamento
        U->>S: Seleciona forma de pagamento e altera dados
        S->>S: Valida dados atualizados
        S->>BD: Atualiza forma de pagamento
        BD->>S: Confirma atualizaÃ§Ã£o
        S->>U: Exibe sucesso e forma de pagamento atualizada
    else Excluir Forma de Pagamento
        U->>S: Seleciona forma de pagamento e confirma exclusÃ£o
        S->>S: Verifica transaÃ§Ãµes associadas
        S->>BD: Remove forma de pagamento (e desvincula de transaÃ§Ãµes, se necessÃ¡rio)
        BD->>S: Confirma remoÃ§Ã£o
        S->>U: Exibe sucesso e remove forma de pagamento da lista
    end
```

1. O usuÃ¡rio autenticado acessa a seÃ§Ã£o de gerenciamento de formas de pagamento.
2. O sistema exibe uma lista de todas as formas de pagamento disponÃ­veis (padrÃ£o e as criadas pelo usuÃ¡rio).
3. O usuÃ¡rio pode:
   a. **Criar Nova Forma de Pagamento:** Preenche o nome, tipo genÃ©rico (ex: "credit_card", "cash") e, opcionalmente,
   uma descriÃ§Ã£o e uma conta bancÃ¡ria/cartÃ£o associada. O sistema valida os dados (nome Ãºnico, tipo vÃ¡lido) e salva a
   nova forma de pagamento no banco de dados.
   b. **Editar Forma de Pagamento Existente:** Seleciona uma forma de pagamento da lista, modifica seu nome, tipo ou
   descriÃ§Ã£o. O sistema valida as alteraÃ§Ãµes e atualiza a forma de pagamento no banco de dados.
   c. **Excluir Forma de Pagamento Existente:** Seleciona uma forma de pagamento e confirma a exclusÃ£o. O sistema
   verifica se hÃ¡ transaÃ§Ãµes vinculadas e pode alertar o usuÃ¡rio ou desvincular automaticamente antes da exclusÃ£o. A
   forma de pagamento Ã© removida do banco de dados.
4. O sistema exibe uma mensagem de sucesso apÃ³s cada operaÃ§Ã£o e atualiza a lista de formas de pagamento.

## ðŸ”€ Fluxos Alternativos

### âš ï¸ FA01 - SugestÃ£o de Forma de Pagamento

1. O sistema pode sugerir formas de pagamento com base em transaÃ§Ãµes anteriores ou padrÃµes de uso.

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - Forma de pagamento nÃ£o encontrada

1. Ao tentar classificar uma transaÃ§Ã£o com uma `payment_method_id` invÃ¡lida ou ao tentar editar/excluir uma forma de
   pagamento inexistente, o sistema exibe uma mensagem de erro indicando que o item nÃ£o foi encontrado.

### âš ï¸ FE02 - Dados de forma de pagamento invÃ¡lidos (para criaÃ§Ã£o/ediÃ§Ã£o)

1. Se o nome da forma de pagamento for muito curto, jÃ¡ existir para o usuÃ¡rio, ou o tipo for invÃ¡lido, o sistema exibe
   uma mensagem de erro especÃ­fica.
2. O sistema retorna ao formulÃ¡rio para que o usuÃ¡rio corrija os dados.

### âš ï¸ FE03 - Tentativa de exclusÃ£o de forma de pagamento com transaÃ§Ãµes associadas

1. Se o usuÃ¡rio tentar excluir uma forma de pagamento que ainda possui transaÃ§Ãµes vinculadas, o sistema alerta o usuÃ¡rio
   e solicita uma aÃ§Ã£o (ex: reatribuir transaÃ§Ãµes ou confirmar exclusÃ£o forÃ§ada).

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP - Criar Forma de Pagamento

```http
POST /api/payment-methods HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "name": "CartÃ£o de CrÃ©dito Principal",
  "type": "credit_card",
  "description": "Meu cartÃ£o de crÃ©dito Visa da conta principal.",
  "account_id": "uuid-da-conta-cartao"
}
```

### RequisiÃ§Ã£o HTTP - Classificar TransaÃ§Ã£o com Forma de Pagamento

```http
PUT /api/transactions/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678/payment-method HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "payment_method_id": "uuid-da-forma-pagamento-pix"
}
```

### RequisiÃ§Ã£o HTTP - Listar Formas de Pagamento

```http
GET /api/payment-methods HTTP/1.1
Host: api.metakyasshu.com
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]
```

### RequisiÃ§Ã£o HTTP - Excluir Forma de Pagamento

```http
DELETE /api/payment-methods/uuid-da-forma-pagamento-a-excluir HTTP/1.1
Host: api.metakyasshu.com
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> --------------------------------------------------------------------------- 