# RF007 ðŸ“ Registro detalhado de receitas e despesas

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade permite o registro detalhado de receitas e despesas, incluindo data, valor, descriÃ§Ã£o, notas,
categoria e forma de pagamento, para um controle financeiro completo e granular.

## ðŸ‘¥ Atores

- ðŸ‘¤ UsuÃ¡rio Autenticado

## âš ï¸ PrÃ©-condiÃ§Ãµes

- O usuÃ¡rio deve estar logado no sistema.
- O usuÃ¡rio deve ter pelo menos uma conta bancÃ¡ria ou dinheiro em espÃ©cie cadastrados para vincular a transaÃ§Ã£o.
- O usuÃ¡rio deve ter categorias de despesas/receitas configuradas (ou usar as padrÃ£o).

## ðŸ”Œ Endpoints

- `POST /api/transactions`
- `GET /api/transactions/{transactionId}`
- `PUT /api/transactions/{transactionId}`
- `DELETE /api/transactions/{transactionId}`

## ðŸ“‹ Dados da TransaÃ§Ã£o (Receita/Despesa)

| Campo               | Tipo     | ObrigatÃ³rio | DescriÃ§Ã£o                                   | RestriÃ§Ãµes                                |
|---------------------|----------|-------------|---------------------------------------------|-------------------------------------------|
| `type`              | `string` | âœ… Sim       | Tipo de transaÃ§Ã£o                           | `revenue`, `expense`                      |
| `amount`            | `number` | âœ… Sim       | Valor da transaÃ§Ã£o                          | Valor positivo, com duas casas decimais   |
| `date`              | `string` | âœ… Sim       | Data da transaÃ§Ã£o                           | Formato YYYY-MM-DD, nÃ£o futura            |
| `description`       | `string` | âœ… Sim       | DescriÃ§Ã£o breve da transaÃ§Ã£o                | MÃ­nimo de 3 caracteres                    |
| `notes`             | `string` | â¬œ NÃ£o       | Notas adicionais sobre a transaÃ§Ã£o          | MÃ¡ximo de 500 caracteres                  |
| `category_id`       | `string` | âœ… Sim       | ID da categoria da transaÃ§Ã£o                | UUID vÃ¡lido, categoria existente          |
| `payment_method_id` | `string` | âœ… Sim       | ID da forma de pagamento utilizada          | UUID vÃ¡lido, forma de pagamento existente |
| `account_id`        | `string` | âœ… Sim       | ID da conta/carteira envolvida na transaÃ§Ã£o | UUID vÃ¡lido, conta/carteira existente     |

## ðŸ”„ Fluxo Principal

```mermaid
sequenceDiagram
    actor U as UsuÃ¡rio
    participant S as Sistema
    participant BD as Banco de Dados
    U->>S: Acessa a seÃ§Ã£o de registro de transaÃ§Ãµes
    S->>U: Exibe formulÃ¡rio para nova transaÃ§Ã£o
    U->>S: Preenche dados (tipo, valor, data, descriÃ§Ã£o, notas, categoria, forma de pagamento, conta)
    S->>S: Valida os dados da transaÃ§Ã£o
    S->>BD: Salva a nova transaÃ§Ã£o
    BD->>S: Confirma o salvamento
    S->>BD: Atualiza o saldo da conta envolvida
    BD->>S: Confirma atualizaÃ§Ã£o de saldo
    S->>U: Exibe mensagem de sucesso e a transaÃ§Ã£o na lista
```

1. O usuÃ¡rio autenticado acessa a seÃ§Ã£o de registro de transaÃ§Ãµes (receitas/despesas).
2. O sistema exibe um formulÃ¡rio para que o usuÃ¡rio insira os detalhes da nova transaÃ§Ã£o.
3. O usuÃ¡rio preenche os campos obrigatÃ³rios e opcionais, incluindo: tipo (receita/despesa), valor, data, descriÃ§Ã£o,
   notas (opcional), categoria, forma de pagamento utilizada e a conta bancÃ¡ria/carteira de onde a transaÃ§Ã£o partiu ou
   para onde foi destinada.
4. O sistema valida os dados informados para garantir a consistÃªncia e a validade (ex: valores positivos, data nÃ£o
   futura, categorias e formas de pagamento existentes).
5. O sistema salva a nova transaÃ§Ã£o no banco de dados, associando-a ao usuÃ¡rio e Ã  conta/perfil especificados.
6. O sistema atualiza o saldo da conta bancÃ¡ria ou dinheiro em espÃ©cie envolvida na transaÃ§Ã£o (aumentando para receitas,
   diminuindo para despesas).
7. O sistema exibe uma mensagem de confirmaÃ§Ã£o de sucesso e a nova transaÃ§Ã£o Ã© adicionada Ã  lista de transaÃ§Ãµes do
   usuÃ¡rio.

## ðŸ”€ Fluxos Alternativos

### âš ï¸ FA01 - EdiÃ§Ã£o de TransaÃ§Ã£o Existente

1. O usuÃ¡rio seleciona uma transaÃ§Ã£o existente na lista para ediÃ§Ã£o.
2. O sistema exibe um formulÃ¡rio prÃ©-preenchido com os dados atuais da transaÃ§Ã£o.
3. O usuÃ¡rio modifica os campos desejados (ex: valor, categoria, descriÃ§Ã£o) e submete as alteraÃ§Ãµes.
4. O sistema valida os novos dados, atualiza a transaÃ§Ã£o no banco de dados e recalcula o impacto no saldo da conta, se
   necessÃ¡rio.
5. O sistema exibe mensagem de sucesso e a transaÃ§Ã£o atualizada na lista.

### âš ï¸ FA02 - ExclusÃ£o de TransaÃ§Ã£o Existente

1. O usuÃ¡rio seleciona uma transaÃ§Ã£o existente na lista para exclusÃ£o.
2. O sistema solicita uma confirmaÃ§Ã£o do usuÃ¡rio para a exclusÃ£o.
3. ApÃ³s a confirmaÃ§Ã£o, o sistema remove a transaÃ§Ã£o do banco de dados e reverte o impacto no saldo da conta envolvida.
4. O sistema exibe mensagem de sucesso e remove a transaÃ§Ã£o da lista.

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - Dados invÃ¡lidos

1. No passo 4 do fluxo principal (ou passos de ediÃ§Ã£o), se os dados informados forem invÃ¡lidos (ex: valor negativo, data
   futura, `category_id` ou `payment_method_id` inexistentes), o sistema exibe uma mensagem de erro especÃ­fica para o
   campo invÃ¡lido.
2. O sistema retorna ao formulÃ¡rio para que o usuÃ¡rio corrija os dados informados.

### âš ï¸ FE02 - Saldo Insuficiente (para despesas)

1. No passo 6 do fluxo principal, se o tipo de transaÃ§Ã£o for `expense` e o valor for maior que o saldo disponÃ­vel na
   conta selecionada, o sistema exibe uma mensagem de erro indicando saldo insuficiente.
2. O sistema nÃ£o registra a transaÃ§Ã£o e retorna ao formulÃ¡rio para que o usuÃ¡rio ajuste o valor ou selecione outra
   conta.

### âš ï¸ FE03 - TransaÃ§Ã£o nÃ£o encontrada (para ediÃ§Ã£o/exclusÃ£o)

1. No fluxo alternativo de ediÃ§Ã£o ou exclusÃ£o, se o `transactionId` fornecido nÃ£o corresponder a uma transaÃ§Ã£o existente
   para o usuÃ¡rio, o sistema exibe uma mensagem de erro indicando que a transaÃ§Ã£o nÃ£o foi encontrada.

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP - Registrar Receita

```http
POST /api/transactions HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "type": "revenue",
  "amount": 1500.00,
  "date": "2023-10-26",
  "description": "SalÃ¡rio mensal",
  "notes": "Referente ao mÃªs de Outubro",
  "category_id": "uuid-da-categoria-salario",
  "payment_method_id": "uuid-da-forma-pagamento-deposito",
  "account_id": "uuid-da-conta-corrente"
}
```

### RequisiÃ§Ã£o HTTP - Registrar Despesa

```http
POST /api/transactions HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "type": "expense",
  "amount": 85.50,
  "date": "2023-10-25",
  "description": "Compras no supermercado",
  "notes": "Compras da semana",
  "category_id": "uuid-da-categoria-alimentacao",
  "payment_method_id": "uuid-da-forma-pagamento-cartao",
  "account_id": "uuid-da-conta-corrente"
}
```

### RequisiÃ§Ã£o HTTP - Obter Detalhes de TransaÃ§Ã£o

```http
GET /api/transactions/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678 HTTP/1.1
Host: api.metakyasshu.com
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]
```

### RequisiÃ§Ã£o HTTP - Atualizar TransaÃ§Ã£o

```http
PUT /api/transactions/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678 HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]

{
  "amount": 90.00,
  "description": "Compras no supermercado (ajuste)"
}
```

### RequisiÃ§Ã£o HTTP - Excluir TransaÃ§Ã£o

```http
DELETE /api/transactions/a1b2c3d4e5f6-1234-5678-90ab-cdef12345678 HTTP/1.1
Host: api.metakyasshu.com
Authorization: Bearer [TOKEN_DE_AUTENTICACAO]
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> --------------------------------------------------------------------------- 