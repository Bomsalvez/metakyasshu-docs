# RF023.1 ðŸ’° Registro de emprÃ©stimos e dÃ­vidas

## ðŸ“ DescriÃ§Ã£o

Esta funcionalidade permite o registro de emprÃ©stimos e dÃ­vidas entre membros, facilitando o controle e o acompanhamento
de transaÃ§Ãµes de crÃ©dito e dÃ©bito entre indivÃ­duos ou grupos. Inclui a capacidade de registrar o valor, a data de
vencimento, juros (se aplicÃ¡vel) e o status do emprÃ©stimo/dÃ­vida.

## ðŸ‘¥ Atores

- ðŸ‘¤ **Credor**: O usuÃ¡rio que emprestou dinheiro.
- ðŸ‘¤ **Devedor**: O usuÃ¡rio que pegou dinheiro emprestado.

## âš ï¸ PrÃ©-condiÃ§Ãµes

- Ambos os usuÃ¡rios (credor e devedor) devem estar autenticados no sistema.
- Ambos os usuÃ¡rios devem ter perfis ativos.

## ðŸ”Œ Endpoints

- `POST /api/loans-debts` (Registrar EmprÃ©stimo/DÃ­vida)
- `GET /api/loans-debts/{loanDebtId}` (Obter Detalhes do EmprÃ©stimo/DÃ­vida)
- `PUT /api/loans-debts/{loanDebtId}` (Atualizar EmprÃ©stimo/DÃ­vida)
- `POST /api/loans-debts/{loanDebtId}/repayment` (Registrar Pagamento)

## ðŸ“‹ Dados de EmprÃ©stimo/DÃ­vida

### Registro/AtualizaÃ§Ã£o de EmprÃ©stimo/DÃ­vida

| Campo          | Tipo                | ObrigatÃ³rio | DescriÃ§Ã£o                                                | RestriÃ§Ãµes                                        |
|----------------|---------------------|-------------|----------------------------------------------------------|---------------------------------------------------|
| `lenderId`     | `string`            | âœ… Sim       | ID do usuÃ¡rio que emprestou o dinheiro (Credor).         | Deve ser um ID de usuÃ¡rio vÃ¡lido e existente.     |
| `borrowerId`   | `string`            | âœ… Sim       | ID do usuÃ¡rio que pegou o dinheiro emprestado (Devedor). | Deve ser um ID de usuÃ¡rio vÃ¡lido e existente.     |
| `amount`       | `number`            | âœ… Sim       | Valor do emprÃ©stimo/dÃ­vida.                              | Deve ser um nÃºmero positivo.                      |
| `currency`     | `string`            | âœ… Sim       | Moeda do emprÃ©stimo/dÃ­vida.                              | Ex: `BRL`, `USD`.                                 |
| `dueDate`      | `string` (ISO 8601) | âœ… Sim       | Data de vencimento do emprÃ©stimo/dÃ­vida.                 | Formato `YYYY-MM-DD`.                             |
| `interestRate` | `number`            | âŒ NÃ£o       | Taxa de juros anual (se aplicÃ¡vel).                      | Valor percentual (ex: 0.05 para 5%).              |
| `description`  | `string`            | âŒ NÃ£o       | DescriÃ§Ã£o do emprÃ©stimo/dÃ­vida.                          | MÃ¡ximo 255 caracteres.                            |
| `status`       | `string`            | âœ… Sim       | Status atual do emprÃ©stimo/dÃ­vida.                       | Valores permitidos: `PENDING`, `PAID`, `OVERDUE`. |

### Registro de Pagamento

| Campo         | Tipo                | ObrigatÃ³rio | DescriÃ§Ã£o                      | RestriÃ§Ãµes                                              |
|---------------|---------------------|-------------|--------------------------------|---------------------------------------------------------|
| `loanDebtId`  | `string`            | âœ… Sim       | ID Ãºnico do emprÃ©stimo/dÃ­vida. | Deve ser um ID de emprÃ©stimo/dÃ­vida vÃ¡lido e existente. |
| `paidAmount`  | `number`            | âœ… Sim       | Valor pago na parcela.         | Deve ser um nÃºmero positivo.                            |
| `paymentDate` | `string` (ISO 8601) | âœ… Sim       | Data do pagamento.             | Formato `YYYY-MM-DD`.                                   |
| `notes`       | `string`            | âŒ NÃ£o       | ObservaÃ§Ãµes sobre o pagamento. | MÃ¡ximo 255 caracteres.                                  |

## ðŸ”„ Fluxo Principal - Registro de EmprÃ©stimo

```mermaid
sequenceDiagram
    actor C as Credor
    actor D as Devedor
    participant S as Sistema
    C ->> S: 1. Registra novo emprÃ©stimo (POST /api/loans-debts)
    S ->> S: 2. Valida dados do emprÃ©stimo
    S ->> S: 3. Cria registro de emprÃ©stimo/dÃ­vida no banco de dados
    S ->> D: 4. Notifica Devedor sobre o novo emprÃ©stimo/dÃ­vida
    S ->> C: 5. Retorna detalhes do emprÃ©stimo criado (HTTP 201 Created)
```

1. O Credor envia uma requisiÃ§Ã£o POST para `/api/loans-debts` com os detalhes do emprÃ©stimo (Credor, Devedor, valor,
   data de vencimento, etc.).
2. O sistema valida os `lenderId`, `borrowerId`, `amount`, `currency` e `dueDate`.
3. O sistema cria um novo registro de emprÃ©stimo/dÃ­vida no banco de dados com status `PENDING`.
4. O sistema pode enviar uma notificaÃ§Ã£o ao Devedor sobre o novo emprÃ©stimo/dÃ­vida registrada em seu nome.
5. O sistema retorna uma resposta HTTP 201 Created com os detalhes do emprÃ©stimo/dÃ­vida recÃ©m-criado, incluindo seu
   `loanDebtId`.

## ðŸ”„ Fluxo Principal - Registro de Pagamento

```mermaid
sequenceDiagram
    actor D as Devedor
    participant S as Sistema
    D ->> S: 1. Registra pagamento de parcela (POST /api/loans-debts/{loanDebtId}/repayment)
    S ->> S: 2. Valida o pagamento e a dÃ­vida
    S ->> S: 3. Atualiza o saldo pendente da dÃ­vida
    S ->> S: 4. Notifica Credor sobre o pagamento
    S ->> D: 5. Retorna confirmaÃ§Ã£o de sucesso (HTTP 200 OK)
```

1. O Devedor envia uma requisiÃ§Ã£o POST para `/api/loans-debts/{loanDebtId}/repayment` com o `paidAmount` e
   `paymentDate`.
2. O sistema valida se o `loanDebtId` existe, se o `paidAmount` Ã© positivo e se a `paymentDate` Ã© vÃ¡lida.
3. O sistema atualiza o saldo pendente do emprÃ©stimo/dÃ­vida e, se o saldo for zero ou negativo, muda o status para
   `PAID`.
4. O sistema pode enviar uma notificaÃ§Ã£o ao Credor sobre o pagamento recebido.
5. O sistema retorna uma resposta HTTP 200 OK com uma mensagem de sucesso e o status atualizado do emprÃ©stimo/dÃ­vida.

## ðŸ”€ Fluxos Alternativos

### âš ï¸ FA01 - DÃ­vida com Juros

1. Se `interestRate` for especificado, o sistema calcula os juros sobre o saldo devedor ao longo do tempo.
2. Os pagamentos sÃ£o aplicados primeiro aos juros acumulados e depois ao principal.

### âš ï¸ FA02 - DÃ­vida Vencida

1. Se a `dueDate` for ultrapassada e o `status` ainda for `PENDING`.
2. O sistema pode automaticamente mudar o status para `OVERDUE` e notificar ambos os usuÃ¡rios.

## ðŸš« Fluxos de ExceÃ§Ã£o

### âš ï¸ FE01 - EmprÃ©stimo/DÃ­vida NÃ£o Encontrada

1. O `loanDebtId` especificado nÃ£o Ã© encontrado.
2. O sistema retorna uma resposta HTTP 404 Not Found.

### âš ï¸ FE02 - Valor InvÃ¡lido

1. O `amount` do emprÃ©stimo ou o `paidAmount` do pagamento Ã© negativo ou zero.
2. O sistema retorna uma resposta HTTP 400 Bad Request.

### âš ï¸ FE03 - UsuÃ¡rio NÃ£o Autorizado (para atualizaÃ§Ã£o ou registro de pagamento de dÃ­vida alheia)

1. Um usuÃ¡rio tenta atualizar uma dÃ­vida que nÃ£o estÃ¡ envolvido ou registrar um pagamento para uma dÃ­vida que nÃ£o Ã© o
   devedor.
2. O sistema retorna uma resposta HTTP 403 Forbidden.

### âš ï¸ FE04 - DÃ­vida JÃ¡ Paga

1. O Devedor tenta registrar um pagamento para uma dÃ­vida que jÃ¡ estÃ¡ com o status `PAID`.
2. O sistema retorna uma resposta HTTP 409 Conflict.

## ðŸ§ª Exemplos de Uso

### RequisiÃ§Ã£o HTTP para Registrar um EmprÃ©stimo (Credor: usr_A, Devedor: usr_B)

```http
POST /api/loans-debts HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json

{
  "lenderId": "usr_A",
  "borrowerId": "usr_B",
  "amount": 150.00,
  "currency": "BRL",
  "dueDate": "2024-09-30",
  "description": "EmprÃ©stimo para conserto do carro"
}
```

### RequisiÃ§Ã£o HTTP para Registrar um Pagamento (Devedor: usr_B)

```http
POST /api/loans-debts/lnd_xyz789/repayment HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json

{
  "paidAmount": 50.00,
  "paymentDate": "2024-08-01",
  "notes": "Primeira parcela"
}
```

### RequisiÃ§Ã£o HTTP para Atualizar Status para Pago (Credor: usr_A)

```http
PUT /api/loans-debts/lnd_xyz789 HTTP/1.1
Host: api.metakyasshu.com
Content-Type: application/json

{
  "status": "PAID"
}
```

---

> ---------------------------------------------------------------------------
> #### ðŸ’° METAKYASSHU ðŸ’°
> ***Transformando finanÃ§as em conquistas compartilhadas***
> --------------------------------------------------------------------------- 